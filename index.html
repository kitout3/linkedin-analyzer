<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyseur LinkedIn - ADN de Marque Cyrus Herez</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script>
        // State management
        let state = {
            employees: [],
            // ===== NOUVEAUX MOTS-CL√âS ADN CYRUS HEREZ =====
            adnKeywords: [
                { group: "Gestion de patrimoine", keywords: ["gestion de patrimoine", "gestion de fortune", "gestion priv√©e"] },
                { group: "Accompagnement", keywords: ["accompagnement", "accompagnement patrimonial", "accompagnement clients"] },
                { group: "Structuration", keywords: ["structurer son patrimoine", "structurer votre patrimoine"] },
                { group: "Allocation", keywords: ["allocation d'actifs", "allocation d'actif"] },
                { group: "Strat√©gie", keywords: ["strat√©gie"] },
                { group: "Sur-mesure", keywords: ["sur-mesure", "sur mesure"] },
                { group: "Optimisation", keywords: ["optimiser"] },
                { group: "S√©curisation", keywords: ["s√©curiser"] },
                { group: "Transmission", keywords: ["transmettre"] },
                { group: "Expertise", keywords: ["expertise patrimoniale", "ing√©nierie patrimoniale"] },
                { group: "Gestion financi√®re", keywords: ["gestion financi√®re"] },
                { group: "Immobilier", keywords: ["immobilier", "investissement immobilier"] },
                { group: "Produits structur√©s", keywords: ["produits structur√©s", "produit structur√©"] },
                { group: "Non cot√©", keywords: ["non cot√©", "non-cot√©"] }
            ],
            // ===== D√âPARTEMENTS SIMPLIFI√âS =====
            departments: [
                { 
                    id: 1, 
                    name: "G√©rant Priv√©", 
                    keywords: [
                        // Conseil patrimonial
                        "conseil patrimonial", "conseiller patrimonial", "conseill√®re patrimoniale", "consultant patrimoine", 
                        "ing√©nieur patrimonial", "patrimoine", "patrimonial", "gestion patrimoine", "gestion de patrimoine", 
                        "wealth management", "strat√©gie patrimoniale", "planification patrimoniale", "accompagnement patrimonial", 
                        "client priv√©", "client√®le priv√©e", "optimisation", "optimisation patrimoniale", "transmission", 
                        "transmission patrimoine", "succession", "donation", "d√©membrement", "assurance vie", 
                        "contrat capitalisation", "compte titres", "√©pargne", "placements", "allocation actifs", 
                        "allocation d'actifs", "diversification", "audit patrimonial", "bilan patrimonial", "diagnostic", 
                        "pr√©conisations", "objectifs patrimoniaux",
                        // Mots-cl√©s additionnels demand√©s
                        "gestion priv√©e", "gestion de fortune", "transmission d'entreprise", "cession", "cession d'entreprise",
                        "r√©mun√©ration du dirigeant", "protection de la famille", "gestion de la tr√©sorerie", 
                        "optimiser sa r√©mun√©ration", "optimiser sa fiscalit√©", "anticiper sa retraite", "transmettre son patrimoine",
                        "performance", "classe d'actif", "produit structur√©", "produits structur√©s", "non cot√©", "non-cot√©",
                        "dette priv√©e", "infrastructure", "private equity", "fond d'investissement", "fonds d'investissement",
                        "allocation de scpi", "scpi", "r√©sidentiel", "r√©sidentielle"
                    ] 
                },
                { 
                    id: 2, 
                    name: "G√©rant de Fortune", 
                    keywords: [
                        // Gestion financi√®re
                        "gestion financi√®re", "gestion actifs", "asset management", "gestion portefeuille", "portfolio management",
                        "g√©rant", "g√©rante", "fund manager", "analyste financier", "analyste", "finance", "finance de march√©",
                        "march√©s financiers", "march√©s", "investissement", "investissements", "allocation", "allocation d'actifs",
                        "asset allocation", "performance", "performance financi√®re", "portefeuille", "portefeuilles",
                        "analyse financi√®re", "analyse", "valorisation", "pricing", "risque", "gestion risque", "risk management",
                        "volatilit√©", "rendement", "obligations", "actions",
                        // Immobilier & Alternatifs
                        "immobilier", "immobilier investissement", "investissement immobilier", "placement immobilier",
                        "scpi", "opci", "sci", "soci√©t√© civile", "fonci√®re", "immobilier locatif", "locatif", "rendement locatif",
                        "loyer", "loyers", "actif immobilier", "actifs r√©els", "real estate", "real assets",
                        "private equity", "capital investissement", "capital risque", "venture capital", "lbo",
                        "dette priv√©e", "private debt", "infrastructure", "infra", "fonds infrastructure",
                        "fonds alternatifs", "co-investissement", "club deal",
                        // Mots-cl√©s additionnels
                        "gestion de fortune", "gestion priv√©e", "gestion de patrimoine", "transmission", "transmission d'entreprise",
                        "cession", "cession d'entreprise", "optimisation", "diversification", "classe d'actif",
                        "produit structur√©", "produits structur√©s", "non cot√©", "non-cot√©", "fond d'investissement",
                        "fonds d'investissement", "allocation de scpi", "r√©sidentiel", "r√©sidentielle"
                    ] 
                }
            ],
            targetCompany: 'Cyrus Herez',
            currentView: 'list',
            selectedEmployee: null,
            companyMission: "Cyrus Herez accompagne les dirigeants, entrepreneurs et familles dans la construction, la s√©curisation et la transmission de leur patrimoine gr√¢ce √† une approche globale int√©grant conseil strat√©gique, ing√©nierie patrimoniale, allocation financi√®re, immobilier et investissements alternatifs."
        };

        // ===== FONCTIONS UTILITAIRES =====

        function loadState() {
            try {
                const saved = localStorage.getItem('employees_v2');
                if (saved) state.employees = JSON.parse(saved);
            } catch (e) {
                console.error('Error loading state:', e);
            }
        }

        function saveState() {
            localStorage.setItem('employees_v2', JSON.stringify(state.employees));
        }

        function processText(text) {
            return text.toLowerCase()
                .replace(/[^\w\s√†√¢√§√©√®√™√´√Ø√Æ√¥√π√ª√º√ø√¶≈ì√ß'-]/gi, ' ')
                .split(/\s+/)
                .filter(word => word.length > 2);
        }

        function normalizeText(text) {
            return text.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
        }

        function extractLinkedInUsername(url) {
            if (!url) return '';
            const match = url.match(/linkedin\.com\/in\/([^\/\?]+)/);
            return match ? match[1] : '';
        }

        function isValidLinkedInURL(url) {
            return /linkedin\.com\/in\/[^\/\?]+/.test(url);
        }

        function extractProfileInfo(text) {
            const lines = text.split('\n').filter(l => l.trim());
            let firstName = '', lastName = '', position = '', company = '';
            
            for (let i = 0; i < Math.min(5, lines.length); i++) {
                const line = lines[i].trim();
                const nameMatch = line.match(/^([A-Z√Ä-√ø][a-z√†-√ø]+(?:\s+[A-Z√Ä-√ø][a-z√†-√ø]+){0,2})\s*$/);
                if (nameMatch && line.length < 40) {
                    const parts = nameMatch[1].split(/\s+/);
                    if (parts.length >= 2) {
                        firstName = parts[0];
                        lastName = parts.slice(1).join(' ');
                        break;
                    }
                }
            }
            
            const positionKeywords = ['manager', 'director', 'ceo', 'cto', 'cfo', 'developer', 'engineer', 'consultant', 'analyst', 'specialist', 'coordinator', 'lead', 'head', 'chef', 'responsable', 'directeur', 'directrice', 'g√©rant', 'associ√©', 'partner', 'founder', 'fondateur', 'conseiller', 'banquier'];
            for (const line of lines) {
                const lowerLine = line.toLowerCase();
                if (positionKeywords.some(keyword => lowerLine.includes(keyword))) {
                    position = line.trim();
                    break;
                }
            }
            
            for (const line of lines) {
                if (line.toLowerCase().includes('chez ') || line.toLowerCase().includes(' at ') || line.toLowerCase().includes('cyrus')) {
                    company = line.replace(/chez |at /gi, '').trim();
                    break;
                }
            }
            
            return { firstName, lastName, position, company };
        }

        function capitalizeWord(str) {
            if (!str) return '';
            return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
        }

        function extractNameFromLinkedInUrl(url) {
            const username = extractLinkedInUsername(url);
            if (!username) return { firstName: '', lastName: '' };
            let slug = decodeURIComponent(username).toLowerCase().replace(/\d+/g, '').replace(/_/g, '-').replace(/\s+/g, '-');
            const parts = slug.split('-').filter(Boolean);
            if (parts.length === 0) return { firstName: '', lastName: '' };
            if (parts.length === 1) return { firstName: capitalizeWord(parts[0]), lastName: '' };
            if (parts.length === 2) return { firstName: capitalizeWord(parts[0]), lastName: capitalizeWord(parts[1]) };
            return { firstName: parts.slice(0, -1).map(capitalizeWord).join(' '), lastName: capitalizeWord(parts[parts.length - 1]) };
        }

        // ===== NOUVEAU CALCUL ADN CYRUS HEREZ =====
        function analyzeADN(profileText) {
            const normalizedText = normalizeText(profileText);
            const wordCount = processText(profileText).length;
            
            let foundGroups = [];
            let missingGroups = [];
            let totalGroups = state.adnKeywords.length;
            
            state.adnKeywords.forEach(group => {
                const normalizedKeywords = group.keywords.map(k => normalizeText(k));
                const found = normalizedKeywords.some(kw => normalizedText.includes(kw));
                const foundKeyword = group.keywords.find(kw => normalizedText.includes(normalizeText(kw)));
                
                if (found) {
                    foundGroups.push({ name: group.group, keyword: foundKeyword });
                } else {
                    missingGroups.push({ name: group.group, suggestions: group.keywords.slice(0, 2) });
                }
            });
            
            const globalScore = Math.round((foundGroups.length / totalGroups) * 100);
            
            return { 
                globalScore, 
                foundGroups, 
                missingGroups, 
                totalGroups,
                wordCount, 
                analyzedAt: new Date().toISOString() 
            };
        }

        // ===== SCORE SSI =====
        function calculateSSI(profileText, employee) {
            const text = profileText.toLowerCase();
            const words = processText(profileText);
            const wordCount = words.length;
            
            // 1. Marque professionnelle (25 pts)
            let brandScore = 0;
            brandScore += (employee.firstName && employee.lastName) ? 5 : 0;
            brandScore += employee.position ? 5 : 0;
            brandScore += wordCount >= 200 ? 10 : (wordCount >= 100 ? 5 : 0);
            brandScore += (text.includes('expert') || text.includes('sp√©cialiste') || text.includes('passion')) ? 5 : 0;
            
            // 2. Trouver les bonnes personnes (25 pts)
            const networkKeywords = ['r√©seau', 'network', 'professionnel', 'contact', 'relation', 'partenaire', 'collaboration'];
            const peopleScore = Math.min(25, networkKeywords.filter(k => text.includes(k)).length * 4);
            
            // 3. √âchanger des informations (25 pts)
            const engageKeywords = ['partage', 'publication', 'article', 'insight', 'analyse', 'expertise', 'conseil', 'contribution'];
            const engagementScore = Math.min(25, engageKeywords.filter(k => text.includes(k)).length * 3.5);
            
            // 4. √âtablir des relations (25 pts)
            // EXPLICATION: Ce score mesure la capacit√© √† cr√©er et maintenir des relations durables
            // Bas√© sur des mots-cl√©s relationnels orient√©s client et long-terme
            const relationKeywords = ['accompagnement', '√©coute', 'client', 'confiance', 'long-terme', 'long terme', 'fid√©lit√©', 'suivi', 'proximit√©', 'partenariat', 'relation durable', 'sur-mesure', 'personnalis√©'];
            const relationScore = Math.min(25, relationKeywords.filter(k => text.includes(k)).length * 3);
            
            const ssiScore = Math.round(brandScore + peopleScore + engagementScore + relationScore);
            
            let sectorRanking = 50, networkRanking = 50;
            if (ssiScore >= 75) { sectorRanking = 10; networkRanking = 15; }
            else if (ssiScore >= 60) { sectorRanking = 20; networkRanking = 24; }
            else if (ssiScore >= 45) { sectorRanking = 35; networkRanking = 40; }
            else if (ssiScore >= 30) { sectorRanking = 50; networkRanking = 55; }
            
            return { 
                ssiScore, 
                ssiBrandScore: Math.round(brandScore), 
                ssiPeopleScore: Math.round(peopleScore), 
                ssiEngagementScore: Math.round(engagementScore), 
                ssiRelationScore: Math.round(relationScore), 
                ssiSectorRanking: sectorRanking, 
                ssiNetworkRanking: networkRanking, 
                ssiAvgSectorScore: 32, 
                ssiAvgNetworkScore: 36,
                // D√©tail des mots-cl√©s trouv√©s pour "√âtablir des relations"
                ssiRelationKeywordsFound: relationKeywords.filter(k => text.includes(k))
            };
        }

        // ===== SCORE LINKEDIN PRO (NOUVELLE VERSION) =====
        function calculateLinkedInScore(profileText, employee) {
            const text = profileText.toLowerCase();
            const normalizedText = normalizeText(text);
            const wordCount = processText(profileText).length;
            
            // ===== 1. IDENTIT√â & CR√âDIBILIT√â IMM√âDIATE (15 pts) =====
            
            // 1.1 Photo de profil (3 pts) - D√©tection am√©lior√©e
            let photoScore = 0;
            const photoIndicators = ['photo', 'image', 'profil', 'portrait'];
            const hasPhotoMention = photoIndicators.some(p => text.includes(p));
            // Si le profil est complet (beaucoup de texte), on suppose une photo pr√©sente
            if (hasPhotoMention || wordCount > 150) photoScore = 3;
            else if (wordCount > 80) photoScore = 2;
            else photoScore = 0;
            
            // 1.2 Image d'arri√®re-plan / Banni√®re (2 pts)
            let bannerScore = 0;
            const bannerIndicators = ['banni√®re', 'banner', 'arri√®re-plan', 'background', 'couverture'];
            const hasBannerMention = bannerIndicators.some(b => text.includes(b));
            // Score conservateur bas√© sur la compl√©tude du profil
            if (hasBannerMention) bannerScore = 2;
            else if (wordCount > 200) bannerScore = 1;
            else bannerScore = 0;
            
            // 1.3 Titre professionnel - DOIT CONTENIR "Intitul√© + Cyrus Herez" (5 pts)
            let headlineScore = 0;
            const hasCyrusHerez = text.includes('cyrus herez') || text.includes('cyrus-herez');
            const positionKeywords = ['g√©rant', 'conseiller', 'directeur', 'manager', 'responsable', 'associ√©', 'partner', 'expert', 'consultant'];
            const hasPositionTitle = positionKeywords.some(k => normalizedText.includes(k));
            
            if (hasCyrusHerez && hasPositionTitle) headlineScore = 5;
            else if (hasCyrusHerez) headlineScore = 4;
            else if (hasPositionTitle && employee.position) headlineScore = 2;
            else if (employee.position) headlineScore = 1;
            else headlineScore = 0;
            
            // 1.4 Localisation & disponibilit√© (5 pts)
            const locationKeywords = ['paris', 'lyon', 'marseille', 'bordeaux', 'nantes', 'toulouse', 'lille', 'france', 'r√©gion', '√Æle-de-france'];
            const hasLocation = locationKeywords.some(l => normalizedText.includes(l));
            const hasCurrentJob = text.includes('actuel') || text.includes('current') || text.includes('pr√©sent') || text.includes('depuis');
            const locationScore = (hasLocation ? 3 : 0) + (hasCurrentJob ? 2 : 0);
            
            const identityScore = photoScore + bannerScore + headlineScore + locationScore; // Max 15
            
            // ===== 2. PROPOSITION DE VALEUR (20 pts) - NOUVEAUX MOTS-CL√âS =====
            
            // V√©rification des mots-cl√©s obligatoires pour la proposition de valeur
            let valuePropositionKeywordsFound = [];
            let valuePropositionKeywordsMissing = [];
            
            state.adnKeywords.forEach(group => {
                const normalizedKeywords = group.keywords.map(k => normalizeText(k));
                const found = normalizedKeywords.some(kw => normalizedText.includes(kw));
                const foundKeyword = group.keywords.find(kw => normalizedText.includes(normalizeText(kw)));
                
                if (found) {
                    valuePropositionKeywordsFound.push({ group: group.group, keyword: foundKeyword });
                } else {
                    valuePropositionKeywordsMissing.push(group.group);
                }
            });
            
            // Score bas√© sur le nombre de groupes de mots-cl√©s trouv√©s
            const valueRatio = valuePropositionKeywordsFound.length / state.adnKeywords.length;
            let summaryScore = Math.round(valueRatio * 10); // Max 10 pts
            
            // Bonus pour la structure et les r√©sultats
            const hasNumbers = /\d+/.test(text);
            const hasResults = ['r√©sultat', 'impact', 'r√©alis', 'atteint', 'd√©velopp', 'augment', 'r√©duit', 'optimis', 'am√©lio', 'g√©n√©r√©'].some(r => normalizedText.includes(r));
            if (hasNumbers && hasResults) summaryScore = Math.min(10, summaryScore + 2);
            
            // Coh√©rence du positionnement (10 pts)
            let coherenceScore = 0;
            const deptKeywordsFound = employee.deptFoundKeywords?.length || 0;
            const deptTotal = employee.deptTotalKeywords || 1;
            const coherenceRatio = deptKeywordsFound / deptTotal;
            
            if (coherenceRatio >= 0.25) coherenceScore = 10;
            else if (coherenceRatio >= 0.15) coherenceScore = 7;
            else if (coherenceRatio >= 0.08) coherenceScore = 5;
            else coherenceScore = 2;
            
            const positioningScore = summaryScore + coherenceScore; // Max 20
            
            // ===== 3. EXP√âRIENCE PROFESSIONNELLE (25 pts) =====
            
            let experienceDetailScore = 0;
            const expKeywords = ['exp√©rience', 'experience', 'poste', 'mission', 'responsab', 'projet', '√©quipe', 'manage', 'pilote', 'd√©velopp'];
            const hasExpDetail = expKeywords.filter(k => normalizedText.includes(k)).length;
            const hasMetrics = /(\d+\s*%|\d+\s*[kKmM]?‚Ç¨|\d+\s*clients?|\d+\s*personnes?|\d+\s*projets?)/.test(text);
            const hasImpact = ['augment', 'r√©duit', 'cr√©√©', 'lanc√©', 'n√©goci', 'sign√©', 'g√©n√©r√©', 'optimis'].some(i => normalizedText.includes(i));
            
            if (hasExpDetail >= 4 && hasMetrics && hasImpact) experienceDetailScore = 15;
            else if (hasExpDetail >= 3 && (hasMetrics || hasImpact)) experienceDetailScore = 12;
            else if (hasExpDetail >= 2 && hasMetrics) experienceDetailScore = 10;
            else if (hasExpDetail >= 2) experienceDetailScore = 8;
            else if (hasExpDetail >= 1) experienceDetailScore = 5;
            else experienceDetailScore = 3;
            
            let progressionScore = 0;
            const seniorityTerms = ['junior', 'confirm√©', 'senior', 'lead', 'manager', 'head', 'directeur', 'vp', 'chief', 'partner', 'associ√©'];
            const progressionTerms = ['promu', '√©volution', 'progression', 'nomm√©', 'devenu', 'promotion'];
            const yearsPattern = /(\d+)\s*ans?/g;
            const yearsMatches = [...normalizedText.matchAll(yearsPattern)];
            const hasLongExp = yearsMatches.some(m => parseInt(m[1]) >= 5);
            const hasSeniority = seniorityTerms.filter(s => normalizedText.includes(s)).length >= 2;
            const hasProgression = progressionTerms.some(p => normalizedText.includes(p));
            
            if (hasProgression && hasSeniority) progressionScore = 10;
            else if (hasLongExp && hasSeniority) progressionScore = 8;
            else if (hasSeniority || hasLongExp) progressionScore = 6;
            else if (hasProgression) progressionScore = 5;
            else progressionScore = 3;
            
            const experienceScore = experienceDetailScore + progressionScore; // Max 25
            
            // ===== 4. COMP√âTENCES & EXPERTISE (20 pts) =====
            
            let skillsScore = 0;
            const skillsKeywords = ['comp√©tence', 'skill', 'expertise', 'ma√Ætrise', 'connaissance', 'savoir-faire', 'sp√©cialit√©'];
            const toolsFound = employee.atsFoundTools?.length || 0;
            const hasSkillsSection = skillsKeywords.some(s => normalizedText.includes(s));
            
            if (toolsFound >= 5 && hasSkillsSection) skillsScore = 10;
            else if (toolsFound >= 3 || (hasSkillsSection && deptKeywordsFound >= 5)) skillsScore = 8;
            else if (toolsFound >= 1 || deptKeywordsFound >= 3) skillsScore = 6;
            else if (hasSkillsSection) skillsScore = 4;
            else skillsScore = 2;
            
            let validationScore = 0;
            const recoMatch = normalizedText.match(/(\d+)\s*recommandation/i);
            const recoCount = recoMatch ? parseInt(recoMatch[1]) : 0;
            const endorsementKeywords = ['valid√©', 'endorsed', 'recommand', 't√©moign', 'r√©f√©rence'];
            const hasEndorsements = endorsementKeywords.some(e => normalizedText.includes(e));
            
            if (recoCount >= 5 && hasEndorsements) validationScore = 10;
            else if (recoCount >= 3 || hasEndorsements) validationScore = 7;
            else if (recoCount >= 1) validationScore = 5;
            else validationScore = 0;
            
            const competenceScore = skillsScore + validationScore; // Max 20
            
            // ===== 5. ENGAGEMENT & VISIBILIT√â (10 pts) =====
            
            let activityScore = 0;
            const activityKeywords = ['publication', 'article', 'post', 'partag', '√©crit', 'publi', 'auteur', 'contributeur'];
            const hasActivity = activityKeywords.filter(a => normalizedText.includes(a)).length;
            
            if (hasActivity >= 3) activityScore = 5;
            else if (hasActivity >= 1) activityScore = 3;
            else activityScore = 0;
            
            // R√©seau
            let networkScore = 0;
            const extractNumber = (text, patterns) => {
                for (const pattern of patterns) {
                    const match = text.match(pattern);
                    if (match) {
                        const numStr = match[1].replace(/[\s\u00A0\.]/g, '').replace(',', '');
                        return parseInt(numStr) || 0;
                    }
                }
                return 0;
            };
            
            const followerPatterns = [
                /([\d\s\u00A0.,]+)\s*abonn[√©e]s?/i,
                /([\d\s\u00A0.,]+)\s*followers?/i
            ];
            const connexionPatterns = [
                /([\d\s\u00A0.,]+)\s*(?:relations?|connexions?|contacts?)/i,
                /plus de\s*([\d\s\u00A0.,]+)\s*(?:relations?|connexions?)/i
            ];
            
            const followersCount = extractNumber(text, followerPatterns);
            const connexionsCount = extractNumber(text, connexionPatterns);
            const networkCount = Math.max(followersCount, connexionsCount);
            
            if (networkCount >= 10000) networkScore = 5;
            else if (networkCount >= 500 || text.includes('plus de 500')) networkScore = 5;
            else if (networkCount >= 200) networkScore = 4;
            else if (networkCount >= 100) networkScore = 3;
            else if (networkCount > 0) networkScore = 2;
            else networkScore = 1;
            
            const engagementScore = activityScore + networkScore; // Max 10
            
            // ===== 6. FORMATION (10 pts) =====
            
            let educationScore = 0;
            const educationKeywords = ['dipl√¥me', 'master', 'licence', 'bachelor', 'ing√©nieur', '√©cole', 'universit√©', 'bac+', 'formation', 'mba', 'doctorat', 'phd'];
            const prestigeSchools = ['hec', 'essec', 'escp', 'edhec', 'polytechnique', 'centrale', 'mines', 'dauphine', 'sciences po', 'insead', 'em lyon'];
            const hasEducation = educationKeywords.filter(e => normalizedText.includes(e)).length;
            const hasPrestige = prestigeSchools.some(s => normalizedText.includes(s));
            
            if (hasPrestige) educationScore = 5;
            else if (hasEducation >= 2) educationScore = 5;
            else if (hasEducation >= 1) educationScore = 3;
            else educationScore = 0;
            
            let certScore = 0;
            const certKeywords = ['certifi', 'certified', 'certification', 'accr√©dit√©', 'agr√©√©', 'habilit√©', 'cfa', 'amf', 'cgp', 'cif', 'iobsp'];
            const hasCerts = certKeywords.filter(c => normalizedText.includes(c)).length;
            
            if (hasCerts >= 3) certScore = 5;
            else if (hasCerts >= 1) certScore = 4;
            else certScore = 0;
            
            const formationScore = educationScore + certScore; // Max 10
            
            // ===== SCORE TOTAL =====
            const linkedinGlobalScore = Math.min(100, identityScore + positioningScore + experienceScore + competenceScore + engagementScore + formationScore);
            
            // ===== R√àGLES NO-GO =====
            const noGoReasons = [];
            if (!hasCyrusHerez) noGoReasons.push("'Cyrus Herez' absent du titre");
            if (experienceDetailScore < 5) noGoReasons.push("Exp√©riences non d√©taill√©es");
            if (headlineScore < 2) noGoReasons.push("Titre non professionnel");
            if (valuePropositionKeywordsFound.length < 3) noGoReasons.push("Proposition de valeur incompl√®te");
            if (wordCount < 50) noGoReasons.push("Profil trop succinct");
            
            const isNoGo = noGoReasons.length >= 2;
            const finalScore = isNoGo ? Math.min(29, linkedinGlobalScore) : linkedinGlobalScore;
            
            // Niveau
            let linkedinLevel, linkedinVerdict;
            if (isNoGo) {
                linkedinLevel = "üî¥ Non pertinent";
                linkedinVerdict = "Profil √©limin√© (r√®gles No-Go)";
            } else if (finalScore >= 85) {
                linkedinLevel = "üèÜ Expert";
                linkedinVerdict = "Profil hautement pertinent";
            } else if (finalScore >= 70) {
                linkedinLevel = "‚úÖ Solide";
                linkedinVerdict = "Profil solide et exploitable";
            } else if (finalScore >= 50) {
                linkedinLevel = "‚ö†Ô∏è Moyen";
                linkedinVerdict = "Profil √† approfondir";
            } else if (finalScore >= 30) {
                linkedinLevel = "üü† Faible";
                linkedinVerdict = "Profil peu diff√©renciant";
            } else {
                linkedinLevel = "üî¥ Insuffisant";
                linkedinVerdict = "Profil non pertinent";
            }
            
            return { 
                linkedinGlobalScore: finalScore,
                linkedinLevel,
                linkedinVerdict,
                linkedinIsNoGo: isNoGo,
                linkedinNoGoReasons: noGoReasons,
                linkedinIdentityScore: identityScore,
                linkedinPhotoScore: photoScore,
                linkedinBannerScore: bannerScore,
                linkedinHeadlineScore: headlineScore,
                linkedinHasCyrusHerez: hasCyrusHerez,
                linkedinLocationScore: locationScore,
                linkedinPositioningScore: positioningScore,
                linkedinSummaryScore: summaryScore,
                linkedinCoherenceScore: coherenceScore,
                linkedinExperienceScore: experienceScore,
                linkedinExpDetailScore: experienceDetailScore,
                linkedinProgressionScore: progressionScore,
                linkedinCompetenceScore: competenceScore,
                linkedinSkillsScore: skillsScore,
                linkedinValidationScore: validationScore,
                linkedinEngagementScore: engagementScore,
                linkedinActivityScore: activityScore,
                linkedinNetworkScore: networkScore,
                linkedinFormationScore: formationScore,
                linkedinEducationScore: educationScore,
                linkedinCertScore: certScore,
                linkedinFollowersCount: followersCount,
                linkedinConnexionsCount: connexionsCount,
                linkedinValueKeywordsFound: valuePropositionKeywordsFound,
                linkedinValueKeywordsMissing: valuePropositionKeywordsMissing
            };
        }

        // ===== SCORE ATS =====
        function calculateATSScore(profileText, employee, deptName) {
            const text = profileText.toLowerCase();
            const normalizedText = normalizeText(text);
            
            // TitleFit
            const seniorTitles = ['directeur', 'director', 'head', 'lead', 'responsable', 'manager', 'chief', 'vp', 'associ√©', 'partner', 'g√©rant'];
            const hasSeniorTitle = seniorTitles.some(t => normalizedText.includes(t));
            const titleMatch = employee.position ? 12 : 0;
            const seniorBonus = hasSeniorTitle ? 8 : 0;
            const titleFit = Math.min(20, titleMatch + seniorBonus);
            
            // ToolsFit
            const toolsKeywords = ['salesforce', 'hubspot', 'excel', 'bloomberg', 'reuters', 'power bi', 'sap', 'oracle'];
            const foundTools = toolsKeywords.filter(t => normalizedText.includes(t));
            const toolsFit = Math.min(15, Math.round((foundTools.length / 3) * 15));
            
            // SeniorityFit
            const yearsPatterns = [/(\d+)\s*(?:ans?|ann√©es?)/gi, /(?:depuis)\s*(\d{4})/gi];
            let totalYears = 0;
            yearsPatterns.forEach(pattern => {
                const matches = normalizedText.matchAll(pattern);
                for (const match of matches) {
                    const num = parseInt(match[1]);
                    if (num > 1900 && num < 2030) totalYears = Math.max(totalYears, 2025 - num);
                    else if (num < 50) totalYears = Math.max(totalYears, num);
                }
            });
            
            const progressionKeywords = ['√©volution', 'promotion', 'promu', 'devenu', 'nomm√©'];
            const hasProgression = progressionKeywords.some(p => normalizedText.includes(p));
            const yearsScore = Math.min(10, totalYears >= 10 ? 10 : totalYears >= 5 ? 7 : totalYears >= 2 ? 4 : 2);
            const progressionBonus = hasProgression ? 5 : (hasSeniorTitle ? 3 : 0);
            const seniorityFit = Math.min(15, yearsScore + progressionBonus);
            
            // ImpactKPI
            const kpiPatterns = [
                /[+\-]?\d+(?:[,\.]\d+)?\s*%/g,
                /\d+(?:[,\.]\d+)?\s*[kKmM]?‚Ç¨/g,
                /\d+\s*(?:clients?|comptes?|dossiers?|projets?)/gi,
                /(?:aum|encours|portefeuille)[\s:]*\d+/gi
            ];
            let kpiCount = 0;
            const kpiMatches = [];
            kpiPatterns.forEach(pattern => {
                const matches = normalizedText.match(pattern) || [];
                kpiCount += matches.length;
                matches.forEach(m => kpiMatches.push(m));
            });
            
            const impactWords = ['augment', 'croissance', 'am√©lio', 'r√©duit', 'optimis', 'g√©n√©r', 'atteint', 'd√©pass'];
            const hasImpactContext = impactWords.some(w => normalizedText.includes(w));
            const kpiQuality = hasImpactContext ? 1 : (kpiCount > 0 ? 0.5 : 0);
            const impactKPI = Math.min(25, Math.round(5 * Math.log1p(kpiCount) + 15 * kpiQuality));
            
            // Credibility
            const recoMatch = normalizedText.match(/(\d+)\s*recommandation/i);
            const recoCount = recoMatch ? parseInt(recoMatch[1]) : 0;
            const certKeywords = ['certifi', 'dipl√¥m', 'master', 'mba', 'cfa', 'amf', 'cgp', 'cif'];
            const certCount = certKeywords.filter(c => normalizedText.includes(c)).length;
            const credibility = Math.min(15, Math.round(Math.min(5, recoCount) + certCount * 1.5 + 2));
            
            // ContextFit
            const sectorKeywords = ['finance', 'banque', 'patrimoine', 'gestion', 'investissement', 'conseil', 'immobilier'];
            const hasSector = sectorKeywords.some(s => normalizedText.includes(s));
            const contextFit = hasSector ? 10 : 4;
            
            // Score final
            const deptScore = employee.deptScore || 0;
            const keywordFitNormalized = (deptScore / 100) * 20;
            
            const rawScore = 
                (titleFit / 20) * 100 * 0.15 +
                (toolsFit / 15) * 100 * 0.10 +
                (seniorityFit / 15) * 100 * 0.13 +
                (impactKPI / 25) * 100 * 0.25 +
                (credibility / 15) * 100 * 0.15 +
                (contextFit / 10) * 100 * 0.10 +
                (keywordFitNormalized / 20) * 100 * 0.12;
            
            const atsScore = Math.round(rawScore);
            
            let atsDecision;
            if (atsScore >= 80) atsDecision = "üü¢ Shortlist";
            else if (atsScore >= 65) atsDecision = "üü° √Ä examiner";
            else if (atsScore >= 40) atsDecision = "üü† En attente";
            else atsDecision = "üî¥ Non retenu";
            
            return {
                atsScore, atsDecision,
                atsTitleFit: titleFit, atsToolsFit: toolsFit, atsSeniorityFit: seniorityFit,
                atsImpactKPI: impactKPI, atsCredibility: credibility, atsContextFit: contextFit,
                atsFoundTools: foundTools, atsKPICount: kpiCount, atsKPIMatches: kpiMatches.slice(0, 10),
                atsTotalYears: totalYears, atsHasProgression: hasProgression, atsCertCount: certCount, atsRecoCount: recoCount
            };
        }

        // ===== SCORE M√âTIER =====
        function calculateDeptScore(profileText, deptName) {
            const dept = state.departments.find(d => d.name === deptName);
            if (!dept) return { score: 0, foundKeywords: [], missingKeywords: [], totalKeywords: 0 };
            
            const normalizedText = normalizeText(profileText);
            
            const foundKeywords = dept.keywords.filter(keyword => {
                const normalizedKeyword = normalizeText(keyword);
                return normalizedText.includes(normalizedKeyword);
            });
            
            return { 
                score: Math.round((foundKeywords.length / dept.keywords.length) * 100), 
                foundKeywords, 
                missingKeywords: dept.keywords.filter(k => !foundKeywords.includes(k)), 
                totalKeywords: dept.keywords.length 
            };
        }

        // ===== AJOUT RAPIDE =====
        function quickAdd() {
            const text = prompt('üìã Collez le contenu du profil LinkedIn ici (Ctrl+V / Cmd+V) :');
            if (!text || text.length < 50) {
                alert('‚ùå Le texte est vide ou trop court. Veuillez copier le profil complet depuis LinkedIn.');
                return;
            }
            const rawLinkedinUrl = prompt('üîó Collez l\'URL du profil LinkedIn (optionnel) :') || '';
            let linkedinUrl = '';
            if (rawLinkedinUrl.trim() !== '' && isValidLinkedInURL(rawLinkedinUrl.trim())) {
                linkedinUrl = rawLinkedinUrl.trim();
            }
            
            const extracted = extractProfileInfo(text);
            let firstName = extracted.firstName || (linkedinUrl ? extractNameFromLinkedInUrl(linkedinUrl).firstName : '') || 'Pr√©nom';
            let lastName = extracted.lastName || (linkedinUrl ? extractNameFromLinkedInUrl(linkedinUrl).lastName : '') || 'Nom';
            
            // Auto-d√©tection du d√©partement
            let autoDept = '', maxScore = 0;
            state.departments.forEach(dept => {
                const deptAnalysis = calculateDeptScore(text, dept.name);
                if (deptAnalysis.score > maxScore) { 
                    maxScore = deptAnalysis.score; 
                    autoDept = dept.name; 
                }
            });
            
            // Si aucun d√©partement d√©tect√©, mettre le premier par d√©faut
            if (!autoDept) autoDept = state.departments[0].name;
            
            const deptAnalysis = calculateDeptScore(text, autoDept);
            const adnAnalysis = analyzeADN(text);
            
            const newEmployee = {
                id: Date.now(), 
                firstName, 
                lastName, 
                position: extracted.position || 'Poste', 
                department: autoDept,
                company: extracted.company || state.targetCompany, 
                linkedinUrl, 
                email: '', 
                profileText: text,
                globalScore: adnAnalysis.globalScore, 
                adnFoundGroups: adnAnalysis.foundGroups,
                adnMissingGroups: adnAnalysis.missingGroups,
                adnTotalGroups: adnAnalysis.totalGroups,
                wordCount: adnAnalysis.wordCount,
                analyzedAt: adnAnalysis.analyzedAt, 
                deptScore: deptAnalysis.score, 
                deptFoundKeywords: deptAnalysis.foundKeywords,
                deptMissingKeywords: deptAnalysis.missingKeywords, 
                deptTotalKeywords: deptAnalysis.totalKeywords, 
                createdAt: new Date().toISOString()
            };
            
            Object.assign(newEmployee, calculateLinkedInScore(text, newEmployee), calculateSSI(text, newEmployee));
            Object.assign(newEmployee, calculateATSScore(text, newEmployee, autoDept));
            
            state.employees.push(newEmployee);
            saveState();
            render();
            
            const linkedinInfo = newEmployee.linkedinIsNoGo ? ' ‚õî NO-GO' : ' ' + newEmployee.linkedinLevel;
            alert('‚úÖ Profil ajout√© : ' + newEmployee.firstName + ' ' + newEmployee.lastName + 
                '\n\nüìä Score SSI : ' + newEmployee.ssiScore + '/100' +
                '\nüîµ Score LinkedIn Pro : ' + newEmployee.linkedinGlobalScore + '/100' + linkedinInfo +
                '\nüß¨ Score ADN : ' + newEmployee.globalScore + '/100' +
                '\nüíº Score M√©tier (' + autoDept + ') : ' + newEmployee.deptScore + '/100' +
                '\nüéØ Score ATS : ' + newEmployee.atsScore + '/100 ' + newEmployee.atsDecision);
        }

        function deleteEmployee(id) {
            if (confirm('Supprimer ce collaborateur ?')) {
                state.employees = state.employees.filter(emp => emp.id !== id);
                saveState();
                render();
            }
        }

        function viewEmployee(id) {
            state.selectedEmployee = state.employees.find(emp => emp.id === id);
            state.currentView = 'detail';
            render();
        }

        function exportData() {
            const blob = new Blob([JSON.stringify({ employees: state.employees, adnKeywords: state.adnKeywords, departments: state.departments, targetCompany: state.targetCompany }, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'linkedin-analyzer-cyrus-' + Date.now() + '.json';
            a.click();
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è Supprimer TOUTES les donn√©es ? Cette action est irr√©versible.')) {
                state.employees = [];
                saveState();
                render();
            }
        }

        function getScoreBadge(score) {
            if (score >= 70) return 'bg-green-100 text-green-800';
            if (score >= 40) return 'bg-yellow-100 text-yellow-800';
            return 'bg-red-100 text-red-800';
        }

        function getScoreColor(score) {
            if (score >= 70) return 'text-green-600';
            if (score >= 40) return 'text-yellow-600';
            return 'text-red-600';
        }

        // ===== SYNTH√àSES =====
        
        function getSSISynthesis(emp) {
            const score = emp.ssiScore || 0;
            let level, description;
            if (score >= 75) {
                level = "üèÜ Excellent";
                description = `${emp.firstName} fait partie des meilleurs profils du secteur avec un SSI de ${score}/100.`;
            } else if (score >= 55) {
                level = "‚úÖ Bon";
                description = `${emp.firstName} a un bon niveau d'activit√© sur LinkedIn avec un SSI de ${score}/100.`;
            } else if (score >= 35) {
                level = "‚ö†Ô∏è √Ä d√©velopper";
                description = `${emp.firstName} a un SSI de ${score}/100, inf√©rieur √† la moyenne du secteur.`;
            } else {
                level = "üî¥ Faible";
                description = `${emp.firstName} a un SSI de ${score}/100, pr√©sence LinkedIn √† construire.`;
            }
            return { level, description };
        }

        function getADNSynthesis(emp) {
            const score = emp.globalScore || 0;
            let level, description;
            if (score >= 70) {
                level = "üèÜ Excellent alignement";
                description = `Le profil refl√®te parfaitement l'ADN Cyrus Herez avec ${emp.adnFoundGroups?.length || 0}/${emp.adnTotalGroups || 14} th√©matiques couvertes.`;
            } else if (score >= 50) {
                level = "‚úÖ Bon alignement";
                description = `${emp.firstName} couvre ${emp.adnFoundGroups?.length || 0}/${emp.adnTotalGroups || 14} th√©matiques. Quelques ajustements renforceraient l'alignement.`;
            } else if (score >= 30) {
                level = "‚ö†Ô∏è Alignement partiel";
                description = `Seulement ${emp.adnFoundGroups?.length || 0}/${emp.adnTotalGroups || 14} th√©matiques pr√©sentes. Un travail sur le vocabulaire est conseill√©.`;
            } else {
                level = "üî¥ Faible alignement";
                description = `Le profil ne refl√®te pas l'ADN Cyrus Herez (${emp.adnFoundGroups?.length || 0}/${emp.adnTotalGroups || 14} th√©matiques).`;
            }
            return { level, description };
        }

        // ===== RENDU =====

        function renderHeader() {
            return `<header class="bg-gradient-to-r from-blue-900 via-blue-800 to-indigo-900 shadow-lg">
                <div class="max-w-7xl mx-auto px-4 py-5">
                    <div class="flex items-center justify-between">
                        <div>
                            <h1 class="text-2xl font-bold text-white">üèõÔ∏è Analyseur LinkedIn - Cyrus Herez</h1>
                            <p class="text-sm text-blue-200 mt-1">Alignement des profils avec l'ADN de l'entreprise</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="exportData()" class="p-2 text-white hover:bg-blue-700 rounded-lg transition" title="Exporter">üì•</button>
                            <button onclick="clearAllData()" class="p-2 text-white hover:bg-red-600 rounded-lg transition" title="Tout supprimer">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
            </header>`;
        }

        function renderEmployeeList() {
            const avgScore = state.employees.length > 0 ? Math.round(state.employees.reduce((sum, emp) => sum + (emp.globalScore || 0), 0) / state.employees.length) : 0;
            const avgLinkedInScore = state.employees.length > 0 ? Math.round(state.employees.reduce((sum, emp) => sum + (emp.linkedinGlobalScore || 0), 0) / state.employees.length) : 0;
            const avgSSIScore = state.employees.length > 0 ? Math.round(state.employees.reduce((sum, emp) => sum + (emp.ssiScore || 0), 0) / state.employees.length) : 0;
            const avgATSScore = state.employees.length > 0 ? Math.round(state.employees.reduce((sum, emp) => sum + (emp.atsScore || 0), 0) / state.employees.length) : 0;
            const noGoCount = state.employees.filter(e => e.linkedinIsNoGo).length;
            
            let html = `<div class="space-y-4">
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200 shadow-sm">
                    <h3 class="text-lg font-bold text-blue-900 mb-2">üèõÔ∏è Cyrus Herez - Gestion Patrimoniale</h3>
                    <p class="text-sm text-blue-800 mb-3">${state.companyMission}</p>
                    <div class="bg-white/60 p-3 rounded-lg mt-3">
                        <p class="text-xs font-semibold text-blue-700 mb-2">üìã Mots-cl√©s ADN obligatoires :</p>
                        <div class="flex flex-wrap gap-1">
                            ${state.adnKeywords.map(g => '<span class="px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs">' + g.group + '</span>').join('')}
                        </div>
                    </div>
                </div>`;
            
            if (state.employees.length > 0) {
                html += `<div class="grid grid-cols-6 gap-3">
                    <div class="bg-white p-4 rounded-xl shadow-sm text-center border"><p class="text-2xl font-bold text-blue-600">${state.employees.length}</p><p class="text-xs text-gray-600 mt-1">Profils</p></div>
                    <div class="bg-white p-4 rounded-xl shadow-sm text-center border"><p class="text-2xl font-bold text-purple-600">${avgSSIScore}</p><p class="text-xs text-gray-600 mt-1">SSI</p></div>
                    <div class="bg-white p-4 rounded-xl shadow-sm text-center border"><p class="text-2xl font-bold text-cyan-600">${avgLinkedInScore}</p><p class="text-xs text-gray-600 mt-1">LinkedIn Pro</p></div>
                    <div class="bg-white p-4 rounded-xl shadow-sm text-center border"><p class="text-2xl font-bold text-green-600">${avgScore}</p><p class="text-xs text-gray-600 mt-1">ADN</p></div>
                    <div class="bg-white p-4 rounded-xl shadow-sm text-center border"><p class="text-2xl font-bold text-amber-600">${avgATSScore}</p><p class="text-xs text-gray-600 mt-1">ATS</p></div>
                    <div class="bg-white p-4 rounded-xl shadow-sm text-center border ${noGoCount > 0 ? 'bg-red-50 border-red-200' : ''}"><p class="text-2xl font-bold ${noGoCount > 0 ? 'text-red-600' : 'text-gray-400'}">${noGoCount}</p><p class="text-xs text-gray-600 mt-1">No-Go</p></div>
                </div>`;
            }
            
            html += `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button onclick="quickAdd()" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white py-5 rounded-xl hover:from-blue-700 hover:to-blue-800 shadow-lg transition transform hover:scale-[1.02]">
                    <div class="font-bold text-lg">‚ö° Coller le texte</div>
                    <div class="text-sm opacity-90 mt-1">Copier-coller le profil LinkedIn</div>
                </button>
                <button onclick="state.currentView = 'add'; render();" class="bg-white border-2 border-gray-300 text-gray-700 py-5 rounded-xl hover:bg-gray-50 hover:border-gray-400 transition">
                    <div class="font-bold text-lg">‚ûï Saisie manuelle</div>
                    <div class="text-sm text-gray-500 mt-1">Formulaire complet</div>
                </button>
            </div>`;
            
            html += '<div class="grid gap-4">';
            state.employees.forEach(emp => {
                const atsDecisionBadge = (emp.atsScore || 0) >= 80 ? 'bg-green-100 text-green-700' : 
                    (emp.atsScore || 0) >= 65 ? 'bg-yellow-100 text-yellow-700' : 
                    (emp.atsScore || 0) >= 40 ? 'bg-orange-100 text-orange-700' : 'bg-red-100 text-red-700';
                const linkedinNoGoBadge = emp.linkedinIsNoGo ? '<span class="text-xs px-2 py-0.5 rounded bg-red-100 text-red-700 font-medium">‚õî NO-GO</span>' : '';
                const cyrusHerezBadge = emp.linkedinHasCyrusHerez ? '<span class="text-xs px-2 py-0.5 rounded bg-green-100 text-green-700">‚úì Cyrus Herez</span>' : '<span class="text-xs px-2 py-0.5 rounded bg-orange-100 text-orange-700">‚ö†Ô∏è Sans Cyrus Herez</span>';
                
                html += `<div class="bg-white p-5 rounded-xl shadow-sm hover:shadow-md transition-all border ${emp.linkedinIsNoGo ? 'border-l-4 border-l-red-500' : 'border-gray-100'}">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 flex-wrap mb-1">
                                <h3 class="text-lg font-bold text-gray-900">${emp.firstName} ${emp.lastName}</h3>
                                ${linkedinNoGoBadge}
                                ${cyrusHerezBadge}
                            </div>
                            <p class="text-gray-600">${emp.position}</p>
                            <div class="flex gap-2 mt-2 text-sm">
                                <span class="px-2 py-0.5 bg-indigo-50 text-indigo-700 rounded font-medium">${emp.department}</span>
                                ${emp.company ? '<span class="text-gray-400">‚Ä¢</span><span class="text-gray-500">' + emp.company + '</span>' : ''}
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <div class="text-center px-3"><div class="px-3 py-1.5 rounded-lg text-sm font-bold ${getScoreBadge(emp.ssiScore || 0)}">${emp.ssiScore || 0}</div><p class="text-xs text-gray-500 mt-1">SSI</p></div>
                            <div class="text-center px-3"><div class="px-3 py-1.5 rounded-lg text-sm font-bold ${getScoreBadge(emp.linkedinGlobalScore || 0)}">${emp.linkedinGlobalScore || 0}</div><p class="text-xs text-gray-500 mt-1">Pro</p></div>
                            <div class="text-center px-3"><div class="px-3 py-1.5 rounded-lg text-sm font-bold ${getScoreBadge(emp.globalScore || 0)}">${emp.globalScore || 0}</div><p class="text-xs text-gray-500 mt-1">ADN</p></div>
                            <div class="text-center px-3"><div class="px-3 py-1.5 rounded-lg text-sm font-bold ${getScoreBadge(emp.deptScore || 0)}">${emp.deptScore || 0}</div><p class="text-xs text-gray-500 mt-1">M√©tier</p></div>
                            <div class="text-center px-3"><div class="px-3 py-1.5 rounded-lg text-sm font-bold ${getScoreBadge(emp.atsScore || 0)}">${emp.atsScore || 0}</div><p class="text-xs text-gray-500 mt-1">ATS</p></div>
                        </div>
                    </div>
                    <div class="flex gap-2 mt-4 pt-4 border-t border-gray-100">
                        <button onclick="viewEmployee(${emp.id})" class="flex-1 px-4 py-2.5 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 font-medium transition">üìä Voir la fiche</button>
                        ${emp.linkedinUrl && isValidLinkedInURL(emp.linkedinUrl) ? '<a href="' + emp.linkedinUrl + '" target="_blank" class="px-4 py-2.5 text-blue-600 hover:bg-blue-50 rounded-lg transition">üîó</a>' : ''}
                        <button onclick="deleteEmployee(${emp.id})" class="px-4 py-2.5 text-red-600 hover:bg-red-50 rounded-lg transition">üóëÔ∏è</button>
                    </div>
                </div>`;
            });
            html += '</div>';
            
            if (state.employees.length === 0) {
                html += `<div class="text-center py-16 bg-white rounded-xl border-2 border-dashed border-gray-300">
                    <div class="text-6xl mb-4">üìä</div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Aucun profil analys√©</h3>
                    <p class="text-gray-600 mb-6">Commencez par ajouter un profil LinkedIn</p>
                    <div class="text-sm text-gray-500 max-w-md mx-auto bg-blue-50 p-4 rounded-lg">
                        <p class="font-medium mb-2">üí° 2 fa√ßons d'ajouter un profil :</p>
                        <div class="text-left space-y-2">
                            <p><strong>‚ö° Coller le texte</strong> - Copiez tout depuis LinkedIn (recommand√©)</p>
                            <p><strong>‚ûï Saisie manuelle</strong> - Formulaire complet avec tous les champs</p>
                        </div>
                    </div>
                </div>`;
            }
            
            html += '</div>';
            return html;
        }

        function renderEmployeeDetail() {
            const emp = state.selectedEmployee;
            if (!emp) return '';
            
            const ssiSynthesis = getSSISynthesis(emp);
            const adnSynthesis = getADNSynthesis(emp);
            
            let html = `<div class="space-y-6">
                <button onclick="state.currentView = 'list'; render();" class="text-blue-600 hover:text-blue-700 font-medium flex items-center gap-2">
                    <span>‚Üê</span> Retour √† la liste
                </button>
                
                <!-- En-t√™te du profil -->
                <div class="bg-white p-6 rounded-xl shadow-sm border">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <div class="flex items-center gap-3 mb-2">
                                <h2 class="text-3xl font-bold text-gray-900">${emp.firstName} ${emp.lastName}</h2>
                                ${emp.linkedinIsNoGo ? '<span class="px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-medium">‚õî NO-GO</span>' : ''}
                                ${emp.linkedinHasCyrusHerez ? '<span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium">‚úì Cyrus Herez dans le titre</span>' : '<span class="px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm font-medium">‚ö†Ô∏è Cyrus Herez absent du titre</span>'}
                            </div>
                            <p class="text-lg text-gray-600">${emp.position}</p>
                            <p class="text-gray-500">${emp.department} ‚Ä¢ ${emp.company}</p>
                        </div>
                        <button onclick="deleteEmployee(${emp.id})" class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition" title="Supprimer">üóëÔ∏è</button>
                    </div>
                    ${emp.linkedinUrl ? '<a href="' + emp.linkedinUrl + '" target="_blank" class="inline-flex items-center gap-2 text-blue-600 hover:underline text-sm bg-blue-50 px-4 py-2 rounded-full">üîó Voir le profil LinkedIn</a>' : ''}
                </div>
                
                <!-- Scores globaux -->
                <div class="bg-white p-6 rounded-xl shadow-sm border">
                    <h3 class="text-lg font-bold mb-4">üèÜ Scores globaux</h3>
                    <div class="grid grid-cols-5 gap-4">
                        <div class="text-center p-4 bg-purple-50 rounded-xl">
                            <p class="text-sm text-purple-700 font-medium mb-2">üìä SSI</p>
                            <span class="text-3xl font-bold ${getScoreColor(emp.ssiScore || 0)}">${emp.ssiScore || 0}</span>
                            <span class="text-gray-500">/100</span>
                        </div>
                        <div class="text-center p-4 bg-cyan-50 rounded-xl">
                            <p class="text-sm text-cyan-700 font-medium mb-2">üîµ LinkedIn Pro</p>
                            <span class="text-3xl font-bold ${getScoreColor(emp.linkedinGlobalScore || 0)}">${emp.linkedinGlobalScore || 0}</span>
                            <span class="text-gray-500">/100</span>
                            <p class="text-xs mt-1 ${emp.linkedinIsNoGo ? 'text-red-600 font-bold' : 'text-gray-500'}">${emp.linkedinLevel || ''}</p>
                        </div>
                        <div class="text-center p-4 bg-green-50 rounded-xl">
                            <p class="text-sm text-green-700 font-medium mb-2">üß¨ ADN</p>
                            <span class="text-3xl font-bold ${getScoreColor(emp.globalScore || 0)}">${emp.globalScore || 0}</span>
                            <span class="text-gray-500">/100</span>
                        </div>
                        <div class="text-center p-4 bg-indigo-50 rounded-xl">
                            <p class="text-sm text-indigo-700 font-medium mb-2">üíº M√©tier</p>
                            <span class="text-3xl font-bold ${getScoreColor(emp.deptScore || 0)}">${emp.deptScore || 0}</span>
                            <span class="text-gray-500">/100</span>
                        </div>
                        <div class="text-center p-4 bg-amber-50 rounded-xl">
                            <p class="text-sm text-amber-700 font-medium mb-2">üéØ ATS</p>
                            <span class="text-3xl font-bold ${getScoreColor(emp.atsScore || 0)}">${emp.atsScore || 0}</span>
                            <span class="text-gray-500">/100</span>
                            <p class="text-xs mt-1 ${(emp.atsScore || 0) >= 65 ? 'text-green-600' : 'text-orange-600'}">${emp.atsDecision || ''}</p>
                        </div>
                    </div>
                </div>`;
            
            // SSI Section
            html += `<div class="bg-gradient-to-r from-purple-50 to-indigo-50 p-6 rounded-xl border border-purple-200">
                <h3 class="text-lg font-bold mb-4 text-purple-900">üìä Social Selling Index (SSI)</h3>
                <div class="bg-white p-4 rounded-lg mb-4 border-l-4 ${(emp.ssiScore || 0) >= 55 ? 'border-green-500' : (emp.ssiScore || 0) >= 35 ? 'border-yellow-500' : 'border-red-500'}">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="font-bold text-lg">${ssiSynthesis.level}</span>
                        <span class="text-2xl font-bold ${getScoreColor(emp.ssiScore || 0)}">${emp.ssiScore || 0}/100</span>
                    </div>
                    <p class="text-gray-700">${ssiSynthesis.description}</p>
                </div>
                <div class="bg-white p-4 rounded-lg">
                    <p class="font-semibold mb-3">Les quatre facteurs SSI</p>
                    <div class="space-y-3">
                        <div>
                            <div class="flex justify-between mb-1"><span class="text-sm">üèÜ Marque professionnelle</span><span class="font-bold ${(emp.ssiBrandScore || 0) >= 18 ? 'text-green-600' : 'text-yellow-600'}">${emp.ssiBrandScore || 0}/25</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2"><div class="h-2 rounded-full bg-orange-500" style="width: ${(emp.ssiBrandScore || 0) * 4}%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1"><span class="text-sm">üë• Trouver les bonnes personnes</span><span class="font-bold ${(emp.ssiPeopleScore || 0) >= 18 ? 'text-green-600' : 'text-yellow-600'}">${emp.ssiPeopleScore || 0}/25</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2"><div class="h-2 rounded-full bg-blue-500" style="width: ${(emp.ssiPeopleScore || 0) * 4}%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1"><span class="text-sm">üí¨ √âchanger des informations</span><span class="font-bold ${(emp.ssiEngagementScore || 0) >= 18 ? 'text-green-600' : 'text-yellow-600'}">${emp.ssiEngagementScore || 0}/25</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2"><div class="h-2 rounded-full bg-purple-500" style="width: ${(emp.ssiEngagementScore || 0) * 4}%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1"><span class="text-sm">ü§ù √âtablir des relations</span><span class="font-bold ${(emp.ssiRelationScore || 0) >= 18 ? 'text-green-600' : 'text-yellow-600'}">${emp.ssiRelationScore || 0}/25</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2"><div class="h-2 rounded-full bg-green-500" style="width: ${(emp.ssiRelationScore || 0) * 4}%"></div></div>
                            <p class="text-xs text-gray-500 mt-1">Bas√© sur : accompagnement, √©coute, client, confiance, long-terme, fid√©lit√©, suivi, proximit√©, partenariat, sur-mesure, personnalis√©</p>
                            ${(emp.ssiRelationKeywordsFound || []).length > 0 ? '<p class="text-xs text-green-600 mt-1">‚úì D√©tect√©s : ' + emp.ssiRelationKeywordsFound.join(', ') + '</p>' : ''}
                        </div>
                    </div>
                </div>
            </div>`;
            
            // LinkedIn Pro Section
            html += `<div class="bg-gradient-to-r from-cyan-50 to-blue-50 p-6 rounded-xl border border-cyan-200">
                <h3 class="text-lg font-bold mb-4 text-cyan-900">üîµ √âvaluation LinkedIn Pro</h3>
                
                <div class="bg-white p-4 rounded-lg mb-4 border-l-4 ${(emp.linkedinGlobalScore || 0) >= 70 ? 'border-green-500' : (emp.linkedinGlobalScore || 0) >= 50 ? 'border-yellow-500' : 'border-red-500'}">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="text-2xl font-bold ${getScoreColor(emp.linkedinGlobalScore || 0)}">${emp.linkedinGlobalScore || 0}/100</span>
                        <span class="px-3 py-1 rounded-full text-sm font-semibold ${(emp.linkedinGlobalScore || 0) >= 85 ? 'bg-green-100 text-green-700' : (emp.linkedinGlobalScore || 0) >= 70 ? 'bg-blue-100 text-blue-700' : (emp.linkedinGlobalScore || 0) >= 50 ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700'}">${emp.linkedinLevel || ''}</span>
                    </div>
                    <p class="text-gray-700">${emp.linkedinVerdict || ''}</p>
                    ${emp.linkedinIsNoGo ? '<div class="mt-3 p-3 bg-red-100 rounded-lg border border-red-300"><p class="text-red-800 font-semibold">‚õî R√®gles √©liminatoires :</p><ul class="text-sm text-red-700 ml-4 mt-1">' + (emp.linkedinNoGoReasons || []).map(r => '<li class="list-disc">' + r + '</li>').join('') + '</ul></div>' : ''}
                </div>
                
                <div class="bg-white p-4 rounded-lg mb-4">
                    <p class="font-semibold mb-3">Analyse des 6 piliers</p>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <div class="flex justify-between mb-1"><span class="text-sm">üë§ Identit√© & Cr√©dibilit√©</span><span class="font-bold ${(emp.linkedinIdentityScore || 0) >= 12 ? 'text-green-600' : 'text-yellow-600'}">${emp.linkedinIdentityScore || 0}/15</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mb-2"><div class="h-2 rounded-full bg-blue-500" style="width: ${((emp.linkedinIdentityScore || 0) / 15) * 100}%"></div></div>
                            <p class="text-xs text-gray-500">Photo ${emp.linkedinPhotoScore || 0}/3 ‚Ä¢ Banni√®re ${emp.linkedinBannerScore || 0}/2 ‚Ä¢ Titre ${emp.linkedinHeadlineScore || 0}/5 ‚Ä¢ Localisation ${emp.linkedinLocationScore || 0}/5</p>
                            <p class="text-xs mt-1 ${emp.linkedinHasCyrusHerez ? 'text-green-600' : 'text-red-600'}">
                                ${emp.linkedinHasCyrusHerez ? '‚úì "Cyrus Herez" pr√©sent dans le titre' : '‚úó "Cyrus Herez" absent du titre'}
                            </p>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1"><span class="text-sm">üí° Proposition de valeur</span><span class="font-bold ${(emp.linkedinPositioningScore || 0) >= 15 ? 'text-green-600' : 'text-yellow-600'}">${emp.linkedinPositioningScore || 0}/20</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mb-2"><div class="h-2 rounded-full bg-purple-500" style="width: ${((emp.linkedinPositioningScore || 0) / 20) * 100}%"></div></div>
                            <p class="text-xs text-gray-500">R√©sum√© ${emp.linkedinSummaryScore || 0}/10 ‚Ä¢ Coh√©rence ${emp.linkedinCoherenceScore || 0}/10</p>
                            <p class="text-xs text-green-600 mt-1">${(emp.linkedinValueKeywordsFound || []).length} mots-cl√©s ADN trouv√©s</p>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1"><span class="text-sm">üíº Exp√©rience</span><span class="font-bold ${(emp.linkedinExperienceScore || 0) >= 18 ? 'text-green-600' : 'text-yellow-600'}">${emp.linkedinExperienceScore || 0}/25</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2"><div class="h-2 rounded-full bg-teal-500" style="width: ${((emp.linkedinExperienceScore || 0) / 25) * 100}%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1"><span class="text-sm">üõ†Ô∏è Comp√©tences</span><span class="font-bold ${(emp.linkedinCompetenceScore || 0) >= 14 ? 'text-green-600' : 'text-yellow-600'}">${emp.linkedinCompetenceScore || 0}/20</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2"><div class="h-2 rounded-full bg-amber-500" style="width: ${((emp.linkedinCompetenceScore || 0) / 20) * 100}%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1"><span class="text-sm">üì¢ Engagement</span><span class="font-bold ${(emp.linkedinEngagementScore || 0) >= 7 ? 'text-green-600' : 'text-yellow-600'}">${emp.linkedinEngagementScore || 0}/10</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2"><div class="h-2 rounded-full bg-indigo-500" style="width: ${((emp.linkedinEngagementScore || 0) / 10) * 100}%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1"><span class="text-sm">üéì Formation</span><span class="font-bold ${(emp.linkedinFormationScore || 0) >= 7 ? 'text-green-600' : 'text-yellow-600'}">${emp.linkedinFormationScore || 0}/10</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2"><div class="h-2 rounded-full bg-pink-500" style="width: ${((emp.linkedinFormationScore || 0) / 10) * 100}%"></div></div>
                        </div>
                    </div>
                </div>
                
                <!-- Mots-cl√©s proposition de valeur -->
                <div class="bg-white p-4 rounded-lg">
                    <p class="font-semibold mb-3">üìã Mots-cl√©s Proposition de Valeur</p>
                    ${(emp.linkedinValueKeywordsFound || []).length > 0 ? '<div class="mb-3"><p class="text-sm text-green-700 font-medium mb-2">‚úÖ Pr√©sents (' + emp.linkedinValueKeywordsFound.length + '/' + state.adnKeywords.length + ')</p><div class="flex flex-wrap gap-2">' + emp.linkedinValueKeywordsFound.map(k => '<span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm">' + k.group + ' (' + k.keyword + ')</span>').join('') + '</div></div>' : ''}
                    ${(emp.linkedinValueKeywordsMissing || []).length > 0 ? '<div><p class="text-sm text-red-700 font-medium mb-2">‚ùå Manquants (' + emp.linkedinValueKeywordsMissing.length + '/' + state.adnKeywords.length + ')</p><div class="flex flex-wrap gap-2">' + emp.linkedinValueKeywordsMissing.map(g => '<span class="px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm">+ ' + g + '</span>').join('') + '</div></div>' : ''}
                </div>
            </div>`;
            
            // ADN Section
            html += `<div class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200">
                <h3 class="text-lg font-bold mb-4 text-green-900">üß¨ Alignement ADN Cyrus Herez</h3>
                
                <div class="bg-white p-4 rounded-lg mb-4 border-l-4 ${(emp.globalScore || 0) >= 50 ? 'border-green-500' : (emp.globalScore || 0) >= 30 ? 'border-yellow-500' : 'border-red-500'}">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="font-bold text-lg">${adnSynthesis.level}</span>
                        <span class="text-2xl font-bold ${getScoreColor(emp.globalScore || 0)}">${emp.globalScore || 0}/100</span>
                    </div>
                    <p class="text-gray-700">${adnSynthesis.description}</p>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded-lg">
                        <p class="font-semibold text-green-800 mb-3">‚úÖ Th√©matiques pr√©sentes (${(emp.adnFoundGroups || []).length}/${emp.adnTotalGroups || 14})</p>
                        <div class="flex flex-wrap gap-2">
                            ${(emp.adnFoundGroups || []).map(g => '<span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm">' + g.name + '</span>').join('')}
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg">
                        <p class="font-semibold text-red-800 mb-3">‚ùå Th√©matiques manquantes (${(emp.adnMissingGroups || []).length}/${emp.adnTotalGroups || 14})</p>
                        <div class="flex flex-wrap gap-2">
                            ${(emp.adnMissingGroups || []).map(g => '<div class="mb-2"><span class="px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm">' + g.name + '</span><p class="text-xs text-gray-500 ml-2 mt-1">Suggestions : ' + g.suggestions.join(', ') + '</p></div>').join('')}
                        </div>
                    </div>
                </div>
            </div>`;
            
            // Score M√©tier Section
            html += `<div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-xl border border-indigo-200">
                <h3 class="text-lg font-bold mb-4 text-indigo-900">üíº Score M√©tier - ${emp.department}</h3>
                
                <div class="bg-white p-4 rounded-lg mb-4 border-l-4 ${(emp.deptScore || 0) >= 60 ? 'border-green-500' : (emp.deptScore || 0) >= 40 ? 'border-yellow-500' : 'border-red-500'}">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-2xl font-bold ${getScoreColor(emp.deptScore || 0)}">${emp.deptScore || 0}/100</span>
                    </div>
                    <p class="text-gray-700">${(emp.deptFoundKeywords || []).length} mots-cl√©s sur ${emp.deptTotalKeywords || 0} du r√©f√©rentiel "${emp.department}".</p>
                </div>
                
                ${(emp.deptFoundKeywords || []).length > 0 ? '<div class="bg-white p-4 rounded-lg mb-4"><p class="font-semibold text-green-800 mb-2">‚úÖ Mots-cl√©s pr√©sents</p><div class="flex flex-wrap gap-2">' + emp.deptFoundKeywords.slice(0, 20).map(k => '<span class="px-2 py-1 bg-green-100 text-green-700 rounded text-sm">' + k + '</span>').join('') + (emp.deptFoundKeywords.length > 20 ? '<span class="px-2 py-1 bg-gray-100 text-gray-600 rounded text-sm">+' + (emp.deptFoundKeywords.length - 20) + ' autres</span>' : '') + '</div></div>' : ''}
            </div>`;
            
            // ATS Section
            html += `<div class="bg-gradient-to-r from-amber-50 to-orange-50 p-6 rounded-xl border border-amber-200">
                <h3 class="text-lg font-bold mb-4 text-amber-900">üéØ Score ATS (Applicant Tracking System)</h3>
                
                <div class="bg-white p-4 rounded-lg mb-4 border-l-4 ${(emp.atsScore || 0) >= 65 ? 'border-green-500' : (emp.atsScore || 0) >= 40 ? 'border-yellow-500' : 'border-red-500'}">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="text-2xl font-bold ${getScoreColor(emp.atsScore || 0)}">${emp.atsScore || 0}/100</span>
                        <span class="px-3 py-1 rounded-full text-sm font-semibold ${(emp.atsScore || 0) >= 80 ? 'bg-green-100 text-green-700' : (emp.atsScore || 0) >= 65 ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700'}">${emp.atsDecision || ''}</span>
                    </div>
                </div>
                
                <div class="bg-white p-4 rounded-lg">
                    <div class="space-y-3">
                        <div>
                            <div class="flex justify-between mb-1"><span class="text-sm">üè∑Ô∏è Titre de poste</span><span class="font-bold">${emp.atsTitleFit || 0}/20</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2"><div class="h-2 rounded-full bg-blue-500" style="width: ${((emp.atsTitleFit || 0) / 20) * 100}%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1"><span class="text-sm">üìä R√©sultats chiffr√©s</span><span class="font-bold">${emp.atsImpactKPI || 0}/25</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2"><div class="h-2 rounded-full bg-purple-500" style="width: ${((emp.atsImpactKPI || 0) / 25) * 100}%"></div></div>
                            ${(emp.atsKPICount || 0) > 0 ? '<p class="text-xs text-green-600 mt-1">' + emp.atsKPICount + ' KPIs d√©tect√©s</p>' : '<p class="text-xs text-red-500 mt-1">Aucun KPI d√©tect√©</p>'}
                        </div>
                        <div>
                            <div class="flex justify-between mb-1"><span class="text-sm">üìÖ Exp√©rience</span><span class="font-bold">${emp.atsSeniorityFit || 0}/15</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2"><div class="h-2 rounded-full bg-amber-500" style="width: ${((emp.atsSeniorityFit || 0) / 15) * 100}%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1"><span class="text-sm">üèÖ Cr√©dibilit√©</span><span class="font-bold">${emp.atsCredibility || 0}/15</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2"><div class="h-2 rounded-full bg-indigo-500" style="width: ${((emp.atsCredibility || 0) / 15) * 100}%"></div></div>
                        </div>
                    </div>
                </div>
            </div>`;
            
            // Synth√®se globale
            const avgScore = Math.round(((emp.ssiScore || 0) + (emp.linkedinGlobalScore || 0) + (emp.globalScore || 0) + (emp.deptScore || 0) + (emp.atsScore || 0)) / 5);
            let globalLevel, globalAdvice;
            
            if (emp.linkedinIsNoGo) {
                globalLevel = "‚õî Profil non exploitable";
                globalAdvice = `Le profil pr√©sente des lacunes critiques qui doivent √™tre corrig√©es en priorit√©.`;
            } else if (avgScore >= 65) {
                globalLevel = "üèÜ Profil exemplaire";
                globalAdvice = `Profil optimis√© et align√© avec Cyrus Herez. Excellent ambassadeur de la marque.`;
            } else if (avgScore >= 45) {
                globalLevel = "‚úÖ Bon profil";
                globalAdvice = `Bon profil avec des axes d'am√©lioration identifi√©s.`;
            } else {
                globalLevel = "‚ö†Ô∏è Profil √† d√©velopper";
                globalAdvice = `Un travail d'optimisation est recommand√©.`;
            }
            
            html += `<div class="bg-gradient-to-r ${emp.linkedinIsNoGo ? 'from-red-600 to-red-700' : 'from-blue-600 to-indigo-700'} p-6 rounded-xl text-white">
                <h3 class="text-xl font-bold mb-3">üìä Synth√®se globale</h3>
                <div class="flex items-center gap-4 mb-4">
                    <div class="bg-white/20 rounded-xl p-4 text-center">
                        <p class="text-4xl font-bold">${avgScore}</p>
                        <p class="text-sm opacity-90">Score moyen</p>
                    </div>
                    <div class="flex-1">
                        <p class="text-lg font-semibold mb-1">${globalLevel}</p>
                        <p class="opacity-90">${globalAdvice}</p>
                    </div>
                </div>
                <div class="grid grid-cols-5 gap-2 text-center text-sm">
                    <div class="bg-white/10 rounded-lg p-3"><p class="font-bold text-lg">${emp.ssiScore || 0}</p><p class="opacity-75 text-xs">SSI</p></div>
                    <div class="bg-white/10 rounded-lg p-3"><p class="font-bold text-lg">${emp.linkedinGlobalScore || 0}</p><p class="opacity-75 text-xs">Pro</p></div>
                    <div class="bg-white/10 rounded-lg p-3"><p class="font-bold text-lg">${emp.globalScore || 0}</p><p class="opacity-75 text-xs">ADN</p></div>
                    <div class="bg-white/10 rounded-lg p-3"><p class="font-bold text-lg">${emp.deptScore || 0}</p><p class="opacity-75 text-xs">M√©tier</p></div>
                    <div class="bg-white/10 rounded-lg p-3"><p class="font-bold text-lg">${emp.atsScore || 0}</p><p class="opacity-75 text-xs">ATS</p></div>
                </div>
                <p class="text-sm opacity-75 mt-4">üìù ${emp.wordCount || 0} mots analys√©s ‚Ä¢ Derni√®re analyse : ${emp.analyzedAt ? new Date(emp.analyzedAt).toLocaleDateString('fr-FR') : 'N/A'}</p>
            </div>`;
            
            html += '</div>';
            return html;
        }

        function renderAddForm() {
            let deptOptions = '<option value="">S√©lectionner...</option>';
            state.departments.forEach(d => {
                deptOptions += `<option value="${d.name}">${d.name}</option>`;
            });
            
            return `<div class="bg-white p-8 rounded-xl shadow-sm max-w-3xl mx-auto border">
                <h2 class="text-2xl font-bold mb-6">‚ûï Ajouter un collaborateur</h2>
                <form onsubmit="handleAddEmployee(event); return false;" class="space-y-5">
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-sm font-medium text-gray-700 mb-2">Pr√©nom *</label><input type="text" id="firstName" required class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" /></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-2">Nom *</label><input type="text" id="lastName" required class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" /></div>
                    </div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-2">Poste</label><input type="text" id="position" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" /></div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-sm font-medium text-gray-700 mb-2">Service</label><select id="department" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">${deptOptions}</select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-2">Entreprise</label><input type="text" id="company" value="${state.targetCompany}" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" /></div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-sm font-medium text-gray-700 mb-2">üìß Email</label><input type="email" id="email" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" /></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-2">üîó URL LinkedIn</label><input type="url" id="linkedinUrl" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" /></div>
                    </div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-2">Profil LinkedIn (texte) *</label><textarea id="profileText" required class="w-full px-4 py-3 border rounded-lg h-48 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Collez le contenu du profil LinkedIn..."></textarea></div>
                    <div class="flex gap-3 pt-4">
                        <button type="submit" class="flex-1 bg-blue-600 text-white py-4 rounded-lg hover:bg-blue-700 font-medium transition">‚úÖ Ajouter</button>
                        <button type="button" onclick="state.currentView = 'list'; render();" class="flex-1 bg-gray-200 text-gray-700 py-4 rounded-lg hover:bg-gray-300 font-medium transition">‚ùå Annuler</button>
                    </div>
                </form>
            </div>`;
        }

        function handleAddEmployee(event) {
            event.preventDefault();
            const profileText = document.getElementById('profileText').value;
            const linkedinUrl = document.getElementById('linkedinUrl')?.value || '';
            const email = document.getElementById('email')?.value || '';
            const department = document.getElementById('department').value || state.departments[0].name;
            
            if (linkedinUrl && !isValidLinkedInURL(linkedinUrl)) { alert('‚ö†Ô∏è URL LinkedIn invalide'); return; }
            if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { alert('‚ö†Ô∏è Email invalide'); return; }
            
            const adnAnalysis = analyzeADN(profileText);
            const deptAnalysis = calculateDeptScore(profileText, department);
            
            const newEmployee = {
                id: Date.now(), 
                firstName: document.getElementById('firstName').value, 
                lastName: document.getElementById('lastName').value,
                position: document.getElementById('position').value, 
                department, 
                company: document.getElementById('company').value,
                email, 
                linkedinUrl, 
                profileText, 
                globalScore: adnAnalysis.globalScore, 
                adnFoundGroups: adnAnalysis.foundGroups,
                adnMissingGroups: adnAnalysis.missingGroups,
                adnTotalGroups: adnAnalysis.totalGroups,
                wordCount: adnAnalysis.wordCount,
                analyzedAt: adnAnalysis.analyzedAt, 
                deptScore: deptAnalysis.score,
                deptFoundKeywords: deptAnalysis.foundKeywords, 
                deptMissingKeywords: deptAnalysis.missingKeywords,
                deptTotalKeywords: deptAnalysis.totalKeywords, 
                createdAt: new Date().toISOString()
            };
            
            Object.assign(newEmployee, calculateLinkedInScore(profileText, newEmployee), calculateSSI(profileText, newEmployee));
            Object.assign(newEmployee, calculateATSScore(profileText, newEmployee, department));
            
            state.employees.push(newEmployee);
            saveState();
            state.currentView = 'list';
            render();
            alert('‚úÖ Profil ajout√© avec succ√®s !');
        }

        function render() {
            const app = document.getElementById('app');
            let content = '';
            if (state.currentView === 'list') content = renderEmployeeList();
            else if (state.currentView === 'detail') content = renderEmployeeDetail();
            else if (state.currentView === 'add') content = renderAddForm();
            app.innerHTML = renderHeader() + '<main class="max-w-7xl mx-auto px-4 py-6">' + content + '</main>';
        }

        loadState();
        render();
    </script>
</body>
</html>

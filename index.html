<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyseur LinkedIn - ADN de Marque</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <!-- Modal pour l'import de fichier -->
    <div id="fileModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full mx-4 overflow-hidden">
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-4">
                <h3 class="text-xl font-bold text-white">üìÑ Importer un fichier</h3>
                <p class="text-indigo-100 text-sm">PDF, PNG, JPG ou capture d'√©cran LinkedIn</p>
            </div>
            <div class="p-6">
                <div id="dropZone" class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-indigo-500 hover:bg-indigo-50 transition-all cursor-pointer">
                    <input type="file" id="fileInput" accept=".pdf,.png,.jpg,.jpeg,.webp" class="hidden" />
                    <div class="text-5xl mb-4">üìÅ</div>
                    <p class="text-gray-700 font-medium mb-2">Glissez un fichier ici</p>
                    <p class="text-gray-500 text-sm mb-4">ou cliquez pour s√©lectionner</p>
                    <p class="text-xs text-gray-400">PDF, PNG, JPG, WEBP ‚Ä¢ Max 10 MB</p>
                </div>
                <div id="filePreview" class="hidden mt-4 p-4 bg-gray-50 rounded-lg">
                    <div class="flex items-center gap-3">
                        <div id="previewIcon" class="text-3xl">üìÑ</div>
                        <div class="flex-1 min-w-0">
                            <p id="fileName" class="font-medium text-gray-900 truncate"></p>
                            <p id="fileSize" class="text-sm text-gray-500"></p>
                        </div>
                        <button onclick="clearFileSelection()" class="text-red-500 hover:bg-red-50 p-2 rounded">‚úï</button>
                    </div>
                </div>
                <div id="processingStatus" class="hidden mt-4">
                    <div class="flex items-center gap-3 p-4 bg-indigo-50 rounded-lg">
                        <div class="animate-spin text-2xl">‚è≥</div>
                        <div>
                            <p class="font-medium text-indigo-900">Analyse en cours...</p>
                            <p id="statusText" class="text-sm text-indigo-700">Extraction du texte avec Claude AI</p>
                        </div>
                    </div>
                </div>
                <div id="errorStatus" class="hidden mt-4">
                    <div class="p-4 bg-red-50 rounded-lg border border-red-200">
                        <p class="font-medium text-red-900">‚ùå Erreur</p>
                        <p id="errorText" class="text-sm text-red-700 mt-1"></p>
                    </div>
                </div>
                <div class="mt-4 p-4 bg-amber-50 rounded-lg border border-amber-200">
                    <p class="text-sm text-amber-800">
                        <strong>üí° Conseil :</strong> Pour de meilleurs r√©sultats, faites une capture d'√©cran compl√®te du profil LinkedIn ou exportez-le en PDF.
                    </p>
                </div>
            </div>
            <div class="px-6 py-4 bg-gray-50 flex gap-3">
                <button id="analyzeFileBtn" onclick="analyzeFile()" disabled class="flex-1 bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed">
                    üîç Analyser le fichier
                </button>
                <button onclick="closeFileModal()" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium">
                    Annuler
                </button>
            </div>
        </div>
    </div>

    <script>
        // Variables globales pour le fichier
        let selectedFile = null;
        let selectedFileBase64 = null;

        // State management
        let state = {
            employees: [],
            brandDNA: [
                { id:1, name:"Excellence patrimoniale & Expertise", weight:30, keywords:["patrimoine","patrimonial","patrimoniale","gestion","conseil","strat√©gie","strat√©gique","ing√©nierie","allocation","optimisation","expertise","expert","performance","financier","immobilier","investissement","transmission","excellence","accompagnement"] },
                { id:2, name:"Ind√©pendance & Int√©grit√©", weight:25, keywords:["ind√©pendance","ind√©pendant","int√©grit√©","transparence","transparent","confiance","√©thique","responsable","capitalistique","partenaire","fiable","authentique"] },
                { id:3, name:"Approche sur-mesure & Client", weight:25, keywords:["sur-mesure","personnalis√©","personnalisation","client","dirigeant","entrepreneur","famille","accompagnement","√©coute","solution","adapt√©","individuel","relation","proximit√©","orientation"] },
                { id:4, name:"Vision long-terme & Durabilit√©", weight:20, keywords:["long-terme","p√©renne","durable","durabilit√©","transmission","transmissible","impact","avenir","coh√©rent","vision","objectif","croissance","transformation","√©volution"] }
            ],
            departments: [
                { id: 1, name: "Direction G√©n√©rale", keywords: ["direction g√©n√©rale","dg","ceo","pr√©sident","directeur g√©n√©ral","strat√©gie globale","vision","gouvernance","comex","comit√© ex√©cutif","leadership","pilotage strat√©gique","croissance","transformation","d√©veloppement"] },
                { id: 2, name: "Direction des Op√©rations", keywords: ["direction op√©rations","coo","op√©rations","process","efficacit√©","organisation","optimisation","coordination","pilotage op√©rationnel","am√©lioration continue","lean","qualit√©","productivit√©"] },
                { id: 3, name: "Direction Financi√®re", keywords: ["direction financi√®re","daf","cfo","finance","tr√©sorerie","budget","comptabilit√©","reporting financier","consolidation","audit","contr√¥le","cash flow","investissement","rentabilit√©"] },
                { id: 4, name: "Direction du D√©veloppement", keywords: ["direction d√©veloppement","croissance","expansion","nouveaux march√©s","partenariats strat√©giques","m&a","acquisitions","diversification","innovation","business development","strat√©gie de croissance"] },
                { id: 5, name: "Secr√©tariat G√©n√©ral", keywords: ["secr√©tariat g√©n√©ral","secr√©taire g√©n√©ral","gouvernance","conseil administration","assembl√©e g√©n√©rale","compliance corporate","affaires juridiques","institutionnel","relations actionnaires"] },
                { id: 6, name: "Direction des Ressources Humaines", keywords: ["drh","direction rh","ressources humaines","strat√©gie rh","politique rh","capital humain","transformation rh","culture d'entreprise","engagement","marque employeur","organisation"] },
                { id: 7, name: "Recrutement & Talent Acquisition", keywords: ["recrutement","talent acquisition","sourcing","chasse","entretiens","onboarding","int√©gration","candidats","offres d'emploi","cvth√®que","linkedin recruiter","cooptation","assessment"] },
                { id: 8, name: "Formation & D√©veloppement des Comp√©tences", keywords: ["formation","d√©veloppement comp√©tences","learning","e-learning","parcours formation","plan de d√©veloppement","coaching","mentoring","upskilling","reskilling","certification","acad√©mie"] },
                { id: 9, name: "Administration RH & Paie", keywords: ["administration rh","paie","gestion administrative","contrats","bulletins","d√©clarations sociales","urssaf","cong√©s","absences","sirh","temps de travail","mutuelle","pr√©voyance"] },
                { id: 10, name: "Relations Sociales & QVT", keywords: ["relations sociales","cse","dialogue social","n√©gociation","accords","qvt","qualit√© de vie","bien-√™tre","pr√©vention","rps","handicap","diversit√©","inclusion","rse sociale"] },
                { id: 11, name: "Gestion des Carri√®res & Mobilit√©", keywords: ["gestion carri√®res","mobilit√©","√©volution professionnelle","entretiens annuels","people review","talent management","hauts potentiels","succession","parcours","promotion","fid√©lisation"] },
                { id: 12, name: "Support Administratif & Services G√©n√©raux", keywords: ["services g√©n√©raux","administratif","accueil","courrier","archivage","fournitures","locaux","maintenance","facilities","prestataires","logistique","moyens g√©n√©raux","office management"] },
                { id: 13, name: "Support IT & Helpdesk", keywords: ["support it","helpdesk","assistance technique","ticketing","incidents","d√©pannage","poste de travail","logiciels","mat√©riel","r√©seau","vpn","support utilisateur","niveau 1","niveau 2"] },
                { id: 14, name: "Support Juridique & Contractuel", keywords: ["support juridique","contrats","r√©vision","n√©gociation contractuelle","conformit√©","litiges","contentieux","veille juridique","rgpd","propri√©t√© intellectuelle","droit des affaires"] },
                { id: 15, name: "Assistanat de Direction", keywords: ["assistante direction","assistant","secr√©tariat","agenda","r√©unions","organisation","d√©placements","notes","comptes-rendus","coordination","filtrage","pr√©paration","support ex√©cutif"] },
                { id: 16, name: "Direction Commerciale", keywords: ["direction commerciale","directeur commercial","strat√©gie commerciale","objectifs","budget commercial","pilotage ventes","animation √©quipe","forecast","pipeline","performance commerciale","kpi ventes"] },
                { id: 17, name: "D√©veloppement Commercial & Business Development", keywords: ["d√©veloppement commercial","business development","prospection","nouveaux clients","conqu√™te","leads","opportunit√©s","rdv","closing","n√©gociation","proposition commerciale","devis"] },
                { id: 18, name: "Conseillers Commerciaux & Banquiers Priv√©s", keywords: ["conseiller commercial","banquier priv√©","banque priv√©e","d√©veloppement portefeuille","rdv clients","proposition de valeur","offre","pr√©sentation","argumentaire","prospection patrimoniale","souscription","signature"] },
                { id: 19, name: "Grands Comptes & Key Account Management", keywords: ["grands comptes","key account","kam","comptes strat√©giques","fid√©lisation","d√©veloppement compte","upselling","cross selling","relation privil√©gi√©e","partenariat","contrats cadre"] },
                { id: 20, name: "Administration des Ventes & ADV", keywords: ["adv","administration ventes","commandes","facturation","suivi","litiges commerciaux","sav","erp","crm","devis","contrats","relances","recouvrement"] },
                { id: 21, name: "Inside Sales & T√©l√©prospection", keywords: ["inside sales","t√©l√©prospection","phoning","qualification","prise de rdv","leads","appels sortants","script","argumentaire t√©l√©phonique","conversion","volume","cadence"] },
                { id: 22, name: "Service Client & Relation Clients", keywords: ["service client","relation client","support client","satisfaction","fid√©lit√©","fid√©lisation","r√©clamation","√©coute","suivi","qualit√© de service","sla","temps de r√©ponse","accueil","hotline"] },
                { id: 23, name: "Middle-Office & Support Commercial", keywords: ["middle office","support commercial","support aux ventes","traitement dossiers","entr√©e en relation","kyc","onboarding","suivi administratif","contr√¥le conformit√©","validation","processus"] },
                { id: 24, name: "Exp√©rience Client & Customer Success", keywords: ["exp√©rience client","customer success","csm","accompagnement client","adoption","satisfaction","nps","churn","r√©tention","parcours client","feedback","am√©lioration continue"] },
                { id: 25, name: "Conseil Patrimonial", keywords: ["conseil","patrimoine","patrimonial","strat√©gie","gestion","accompagnement","client","optimisation","transmission","ing√©nierie"] },
                { id: 26, name: "Gestion Financi√®re", keywords: ["finance","financier","march√©s","investissement","allocation","performance","portefeuille","gestion","analyse","risque"] },
                { id: 27, name: "Immobilier & Alternatifs", keywords: ["immobilier","alternatif","investissement","placement","actif","diversification","rendement","loyer","actifs r√©els","scpi","opci","private equity"] },
                { id: 28, name: "Marketing & Communication", keywords: ["marketing","communication","marque","branding","campagne","contenu","digital","r√©seaux sociaux","linkedin","√©v√©nementiel","webinar","lead generation","nurturing","newsletter","community manager","community management","social media","social media manager","e-reputation","e-r√©putation","r√©putation","planning √©ditorial","√©ditorial","podcast","webmaster","site web","r√©daction","r√©dacteur","content","content manager","influenceur","veille","mod√©ration","animation","animateur","strat√©gie de communication","strat√©gie digitale","marque employeur","marque-employeur"] },
                { id: 29, name: "Marketing Digital & Growth", keywords: ["marketing digital","growth","seo","sea","acquisition digitale","analytics","google analytics","taux conversion","landing page","tracking","ab test","performance digitale","automation","dataviz","data visualisation","power bi","reporting","statistiques","r√©f√©rencement","sem","emailing","campagnes","crm","hubspot","mailchimp","inbound","outbound"] },
                { id: 30, name: "Conformit√© & Contr√¥le Interne", keywords: ["conformit√©","compliance","contr√¥le interne","lcb ft","kyc","r√©glementaire","audit","risque","proc√©dure","politique conformit√©","amf","acpr","contr√¥le permanent","contr√¥le p√©riodique"] },
                { id: 31, name: "Juridique & Fiscalit√©", keywords: ["juridique","droit","fiscal","fiscalit√©","contrat","structuration","pacte associ√©s","holding","transmission","donation","succession","optimisation fiscale","cadre juridique"] },
                { id: 32, name: "Comptabilit√©", keywords: ["comptabilit√©","comptable","√©critures","bilan","cl√¥ture","grand livre","fournisseurs","clients","tr√©sorerie","rapprochement","normes comptables","audit"] },
                { id: 33, name: "Contr√¥le de Gestion", keywords: ["contr√¥le gestion","contr√¥leur gestion","reporting","budget","forecast","pilotage performance","indicateurs","kpi","analyse financi√®re","marge","rentabilit√©","p&l"] },
                { id: 34, name: "IT, Syst√®mes d'Information & Data", keywords: ["it","syst√®mes information","informatique","data","donn√©e","reporting","bi","tableau de bord","crm","salesforce","power bi","s√©curit√©","cybers√©curit√©","processus digitaux","automatisation"] },
                { id: 35, name: "D√©veloppement & Projets IT", keywords: ["d√©veloppement","projets it","chef de projet","moa","moe","agile","scrum","int√©gration","api","architecture","infrastructure","cloud","devops","delivery"] },
                { id: 36, name: "Back-Office & Op√©rations", keywords: ["back office","op√©rations","traitement","r√®glement livraison","op√©rations titres","flux","cash","process","contr√¥les","ex√©cution","suivi administratif","reconciliations","settlement"] }
            ],
            targetCompany: 'Cyrus Herez',
            currentView: 'list',
            selectedEmployee: null,
            companyMission: "Cyrus Herez accompagne les dirigeants, entrepreneurs et familles dans la construction, la s√©curisation et la transmission de leur patrimoine gr√¢ce √† une approche globale int√©grant conseil strat√©gique, ing√©nierie patrimoniale, allocation financi√®re, immobilier et investissements alternatifs."
        };

        // ===== FONCTIONS POUR LE MODAL DE FICHIER =====
        
        function openFileModal() {
            document.getElementById('fileModal').classList.remove('hidden');
            clearFileSelection();
        }

        function closeFileModal() {
            document.getElementById('fileModal').classList.add('hidden');
            clearFileSelection();
        }

        function clearFileSelection() {
            selectedFile = null;
            selectedFileBase64 = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('filePreview').classList.add('hidden');
            document.getElementById('dropZone').classList.remove('hidden');
            document.getElementById('processingStatus').classList.add('hidden');
            document.getElementById('errorStatus').classList.add('hidden');
            document.getElementById('analyzeFileBtn').disabled = true;
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        function handleFileSelect(file) {
            if (!file) return;
            
            const maxSize = 10 * 1024 * 1024;
            if (file.size > maxSize) {
                showError('Le fichier est trop volumineux (max 10 MB)');
                return;
            }

            const validTypes = ['application/pdf', 'image/png', 'image/jpeg', 'image/jpg', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                showError('Format non support√©. Utilisez PDF, PNG, JPG ou WEBP');
                return;
            }

            selectedFile = file;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                selectedFileBase64 = e.target.result.split(',')[1];
                
                document.getElementById('dropZone').classList.add('hidden');
                document.getElementById('filePreview').classList.remove('hidden');
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('fileSize').textContent = formatFileSize(file.size);
                
                const icon = file.type === 'application/pdf' ? 'üìÑ' : 'üñºÔ∏è';
                document.getElementById('previewIcon').textContent = icon;
                
                document.getElementById('analyzeFileBtn').disabled = false;
            };
            reader.readAsDataURL(file);
        }

        function showError(message) {
            document.getElementById('errorStatus').classList.remove('hidden');
            document.getElementById('errorText').textContent = message;
            document.getElementById('processingStatus').classList.add('hidden');
        }

        function showProcessing(message) {
            document.getElementById('processingStatus').classList.remove('hidden');
            document.getElementById('statusText').textContent = message;
            document.getElementById('errorStatus').classList.add('hidden');
        }

        async function analyzeFile() {
            if (!selectedFile || !selectedFileBase64) {
                showError('Aucun fichier s√©lectionn√©');
                return;
            }

            document.getElementById('analyzeFileBtn').disabled = true;
            showProcessing('Envoi du fichier √† Claude AI...');

            try {
                let mediaType = selectedFile.type;
                if (mediaType === 'image/jpg') mediaType = 'image/jpeg';

                let content = [];
                
                if (selectedFile.type === 'application/pdf') {
                    content = [
                        { type: "document", source: { type: "base64", media_type: "application/pdf", data: selectedFileBase64 } },
                        { type: "text", text: `Analyse ce profil LinkedIn (PDF). Extrais TOUT le texte visible du profil, incluant: nom complet, poste actuel, entreprise, r√©sum√©/√† propos, exp√©riences professionnelles, comp√©tences, formation. R√©ponds UNIQUEMENT avec le texte extrait, sans commentaire ni mise en forme.` }
                    ];
                } else {
                    content = [
                        { type: "image", source: { type: "base64", media_type: mediaType, data: selectedFileBase64 } },
                        { type: "text", text: `Analyse cette capture d'√©cran de profil LinkedIn. Extrais TOUT le texte visible du profil, incluant: nom complet, poste actuel, entreprise, r√©sum√©/√† propos, exp√©riences professionnelles, comp√©tences, formation. R√©ponds UNIQUEMENT avec le texte extrait, sans commentaire ni mise en forme.` }
                    ];
                }

                showProcessing('Extraction du texte en cours...');

                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 4000,
                        messages: [{ role: "user", content: content }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error?.message || `Erreur API: ${response.status}`);
                }

                const data = await response.json();
                
                const extractedText = data.content
                    .filter(item => item.type === "text")
                    .map(item => item.text)
                    .join("\n");

                if (!extractedText || extractedText.length < 50) {
                    throw new Error('Le texte extrait est trop court. Assurez-vous que l\'image/PDF contient un profil LinkedIn lisible.');
                }

                showProcessing('Analyse du profil...');
                closeFileModal();
                processExtractedText(extractedText);

            } catch (error) {
                console.error('Erreur:', error);
                showError(error.message || 'Erreur lors de l\'analyse du fichier');
                document.getElementById('analyzeFileBtn').disabled = false;
            }
        }

        function processExtractedText(text) {
            const rawLinkedinUrl = prompt('üîó Collez l\'URL du profil LinkedIn (optionnel) :') || '';
            let linkedinUrl = '';
            if (rawLinkedinUrl.trim() !== '') {
                if (!isValidLinkedInURL(rawLinkedinUrl.trim())) {
                    alert('‚ö†Ô∏è L\'URL LinkedIn n\'est pas au bon format.\nFormat attendu : https://www.linkedin.com/in/username/');
                    return;
                }
                linkedinUrl = rawLinkedinUrl.trim();
            }

            const extracted = extractProfileInfo(text);
            const analysis = analyzeProfile(text);
            
            let firstName = extracted.firstName;
            let lastName = extracted.lastName;
            
            if ((!firstName || !lastName) && linkedinUrl) {
                const nameFromUrl = extractNameFromLinkedInUrl(linkedinUrl);
                if (!firstName) firstName = nameFromUrl.firstName || 'Pr√©nom';
                if (!lastName)  lastName  = nameFromUrl.lastName  || 'Nom';
            }
            if (!firstName) firstName = 'Pr√©nom';
            if (!lastName)  lastName  = 'Nom';
            
            let autoDept = '';
            let maxScore = 0;
            state.departments.forEach(dept => {
                const deptAnalysis = calculateDeptScore(text, dept.name);
                if (deptAnalysis.score > maxScore) {
                    maxScore = deptAnalysis.score;
                    autoDept = dept.name;
                }
            });
            
            const deptAnalysis = calculateDeptScore(text, autoDept);
            
            const newEmployee = {
                id: Date.now(),
                firstName: firstName,
                lastName: lastName,
                position: extracted.position || 'Poste',
                department: autoDept,
                company: extracted.company || state.targetCompany,
                linkedinUrl: linkedinUrl,
                email: '',
                profileText: text,
                globalScore: analysis.globalScore,
                axisScores: analysis.axisScores,
                wordCount: analysis.wordCount,
                analyzedAt: analysis.analyzedAt,
                deptScore: deptAnalysis.score,
                deptFoundKeywords: deptAnalysis.foundKeywords,
                deptMissingKeywords: deptAnalysis.missingKeywords,
                deptTotalKeywords: deptAnalysis.totalKeywords,
                createdAt: new Date().toISOString(),
                importedFrom: 'file'
            };
            
            const linkedinScores = calculateLinkedInScore(text, newEmployee);
            Object.assign(newEmployee, linkedinScores);
            
            const ssiScores = calculateSSI(text, newEmployee);
            Object.assign(newEmployee, ssiScores);
            
            state.employees.push(newEmployee);
            saveState();
            render();
            
            alert(
                '‚úÖ Profil import√© : ' + newEmployee.firstName + ' ' + newEmployee.lastName +
                '\n\nüìä Score SSI : ' + newEmployee.ssiScore + '/100' +
                '\nüîµ Score LinkedIn : ' + newEmployee.linkedinGlobalScore + '/100' +
                '\nüß¨ Score ADN : ' + newEmployee.globalScore + '/100' +
                '\nüíº Score M√©tier : ' + newEmployee.deptScore + '/100'
            );
        }

        // Event listeners pour le drag & drop
        document.addEventListener('DOMContentLoaded', function() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');

            dropZone.addEventListener('click', () => fileInput.click());
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileSelect(e.target.files[0]);
                }
            });

            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('border-indigo-500', 'bg-indigo-50');
            });

            dropZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                dropZone.classList.remove('border-indigo-500', 'bg-indigo-50');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('border-indigo-500', 'bg-indigo-50');
                if (e.dataTransfer.files.length > 0) {
                    handleFileSelect(e.dataTransfer.files[0]);
                }
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closeFileModal();
            });
        });

        // ===== FONCTIONS EXISTANTES =====

        function loadState() {
            try {
                const saved = localStorage.getItem('employees');
                if (saved) state.employees = JSON.parse(saved);
            } catch (e) {
                console.error('Error loading state:', e);
            }
        }

        function saveState() {
            localStorage.setItem('employees', JSON.stringify(state.employees));
        }

        function processText(text) {
            return text.toLowerCase()
                .replace(/[^\w\s√†√¢√§√©√®√™√´√Ø√Æ√¥√π√ª√º√ø√¶≈ì√ß]/gi, ' ')
                .split(/\s+/)
                .filter(word => word.length > 2);
        }

        function extractLinkedInUsername(url) {
            if (!url) return '';
            const match = url.match(/linkedin\.com\/in\/([^\/\?]+)/);
            return match ? match[1] : '';
        }

        function isValidLinkedInURL(url) {
            return /linkedin\.com\/in\/[^\/\?]+/.test(url);
        }

        function extractProfileInfo(text) {
            const lines = text.split('\n').filter(l => l.trim());
            let firstName = '', lastName = '', position = '', company = '';
            
            for (let i = 0; i < Math.min(5, lines.length); i++) {
                const line = lines[i].trim();
                const nameMatch = line.match(/^([A-Z√Ä-√ø][a-z√†-√ø]+(?:\s+[A-Z√Ä-√ø][a-z√†-√ø]+){0,2})\s*$/);
                if (nameMatch && line.length < 40) {
                    const parts = nameMatch[1].split(/\s+/);
                    if (parts.length >= 2) {
                        firstName = parts[0];
                        lastName = parts.slice(1).join(' ');
                        break;
                    }
                }
            }
            
            const positionKeywords = ['manager', 'director', 'ceo', 'cto', 'cfo', 'developer', 'engineer', 'consultant', 'analyst', 'specialist', 'coordinator', 'lead', 'head', 'chef', 'responsable', 'directeur', 'directrice', 'g√©rant', 'associ√©', 'partner', 'founder', 'fondateur', 'conseiller', 'banquier'];
            for (const line of lines) {
                const lowerLine = line.toLowerCase();
                if (positionKeywords.some(keyword => lowerLine.includes(keyword))) {
                    position = line.trim();
                    break;
                }
            }
            
            for (const line of lines) {
                if (line.toLowerCase().includes('chez ') || line.toLowerCase().includes(' at ') || line.toLowerCase().includes('cyrus')) {
                    company = line.replace(/chez |at /gi, '').trim();
                    break;
                }
            }
            
            return { firstName, lastName, position, company };
        }

        function capitalizeWord(str) {
            if (!str) return '';
            return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
        }

        function extractNameFromLinkedInUrl(url) {
            const username = extractLinkedInUsername(url);
            if (!username) return { firstName: '', lastName: '' };
            let slug = decodeURIComponent(username).toLowerCase().replace(/\d+/g, '').replace(/_/g, '-').replace(/\s+/g, '-');
            const parts = slug.split('-').filter(Boolean);
            if (parts.length === 0) return { firstName: '', lastName: '' };
            if (parts.length === 1) return { firstName: capitalizeWord(parts[0]), lastName: '' };
            if (parts.length === 2) return { firstName: capitalizeWord(parts[0]), lastName: capitalizeWord(parts[1]) };
            return { firstName: parts.slice(0, -1).map(capitalizeWord).join(' '), lastName: capitalizeWord(parts[parts.length - 1]) };
        }

        function analyzeProfile(profileText) {
            const words = processText(profileText);
            const wordCount = words.length;
            const axisScores = state.brandDNA.map(axis => {
                const foundKeywords = axis.keywords.filter(keyword => 
                    words.some(word => word.includes(keyword.toLowerCase()) || keyword.toLowerCase().includes(word))
                );
                const rawScore = (foundKeywords.length / axis.keywords.length) * 100;
                return {
                    axisId: axis.id,
                    axisName: axis.name,
                    score: Math.round(rawScore),
                    foundKeywords: foundKeywords,
                    missingKeywords: axis.keywords.filter(k => !foundKeywords.includes(k))
                };
            });
            const totalWeight = state.brandDNA.reduce((sum, axis) => sum + axis.weight, 0);
            const globalScore = Math.round(
                axisScores.reduce((sum, score) => {
                    const axis = state.brandDNA.find(a => a.id === score.axisId);
                    return sum + (score.score * axis.weight / totalWeight);
                }, 0)
            );
            return { globalScore, axisScores, wordCount, analyzedAt: new Date().toISOString() };
        }

        function calculateSSI(profileText, employee) {
            const text = profileText.toLowerCase();
            const words = processText(profileText);
            const wordCount = words.length;
            let brandScore = 0;
            brandScore += (employee.firstName && employee.lastName) ? 5 : 0;
            brandScore += employee.position ? 5 : 0;
            brandScore += wordCount >= 200 ? 10 : (wordCount >= 100 ? 5 : 0);
            brandScore += (text.includes('expert') || text.includes('sp√©cialiste') || text.includes('passion')) ? 5 : 0;
            const networkKeywords = ['r√©seau', 'network', 'professionnel', 'contact', 'relation', 'partenaire', 'collaboration'];
            const peopleScore = Math.min(25, networkKeywords.filter(k => text.includes(k)).length * 4);
            const engageKeywords = ['partage', 'publication', 'article', 'insight', 'analyse', 'expertise', 'conseil', 'contribution'];
            const engagementScore = Math.min(25, engageKeywords.filter(k => text.includes(k)).length * 3.5);
            const relationKeywords = ['accompagnement', '√©coute', 'client', 'confiance', 'long-terme', 'fid√©lit√©', 'suivi', 'proximit√©'];
            const relationScore = Math.min(25, relationKeywords.filter(k => text.includes(k)).length * 3.5);
            const ssiScore = Math.round(brandScore + peopleScore + engagementScore + relationScore);
            let sectorRanking = 50, networkRanking = 50;
            if (ssiScore >= 75) { sectorRanking = 10; networkRanking = 15; }
            else if (ssiScore >= 60) { sectorRanking = 20; networkRanking = 24; }
            else if (ssiScore >= 45) { sectorRanking = 35; networkRanking = 40; }
            else if (ssiScore >= 30) { sectorRanking = 50; networkRanking = 55; }
            return { ssiScore, ssiBrandScore: Math.round(brandScore), ssiPeopleScore: Math.round(peopleScore), ssiEngagementScore: Math.round(engagementScore), ssiRelationScore: Math.round(relationScore), ssiSectorRanking: sectorRanking, ssiNetworkRanking: networkRanking, ssiAvgSectorScore: 32, ssiAvgNetworkScore: 36 };
        }

        function calculateLinkedInScore(profileText, employee) {
            const text = profileText.toLowerCase();
            const words = processText(profileText);
            const wordCount = words.length;
            const sections = {
                hasName: (employee.firstName && employee.lastName) ? 20 : 0,
                hasPosition: employee.position ? 15 : 0,
                hasCompany: employee.company ? 10 : 0,
                hasRichContent: wordCount >= 200 ? 25 : (wordCount >= 100 ? 15 : wordCount >= 50 ? 10 : 0),
                hasExperience: (text.includes('exp√©rience') || text.includes('experience') || text.includes('depuis') || text.includes('ann√©es')) ? 15 : 0,
                hasSkills: (text.includes('comp√©tence') || text.includes('expertise') || text.includes('ma√Ætrise') || text.includes('skills')) ? 15 : 0
            };
            const completudeScore = Object.values(sections).reduce((a, b) => a + b, 0);
            const coherenceScore = employee.globalScore;
            const seoKeywords = ['patrimoine', 'gestion', 'conseil', 'strat√©gie', 'investissement', 'finance', 'immobilier', 'transmission', 'accompagnement', 'dirigeant', 'entrepreneur', 'famille', 'performance', 'optimisation', 'allocation'];
            const foundSEOKeywords = seoKeywords.filter(kw => text.includes(kw));
            const visibilityScore = Math.min(100, (foundSEOKeywords.length / seoKeywords.length) * 100 + (wordCount >= 200 ? 20 : 0));
            const engagementIndicators = {
                hasActionVerbs: /\b(accompagn|d√©velopp|conseill|aid|soutien|guid|optimis|transform|innov|cr√©√©|r√©alis|pilote)\w*/.test(text) ? 25 : 0,
                hasNumbers: /\d+/.test(text) ? 20 : 0,
                hasImpactWords: (text.includes('impact') || text.includes('r√©sultat') || text.includes('succ√®s') || text.includes('croissance') || text.includes('am√©lioration')) ? 25 : 0,
                hasProfessionalTone: wordCount >= 150 ? 15 : (wordCount >= 80 ? 10 : 0),
                hasClientFocus: (text.includes('client') || text.includes('partenaire') || text.includes('relation')) ? 15 : 0
            };
            const engagementScore = Object.values(engagementIndicators).reduce((a, b) => a + b, 0);
            const linkedinGlobalScore = Math.round((completudeScore + coherenceScore + visibilityScore + engagementScore) / 4);
            return { linkedinGlobalScore, completudeScore: Math.round(completudeScore), coherenceScore: Math.round(coherenceScore), visibilityScore: Math.round(visibilityScore), engagementScore: Math.round(engagementScore), foundSEOKeywords };
        }

        function calculateDeptScore(profileText, deptName) {
            const dept = state.departments.find(d => d.name === deptName);
            if (!dept) return { score: 0, foundKeywords: [], missingKeywords: [], totalKeywords: 0 };
            const words = processText(profileText);
            const foundKeywords = dept.keywords.filter(keyword => 
                words.some(word => word.includes(keyword.toLowerCase()) || keyword.toLowerCase().includes(word))
            );
            return { score: Math.round((foundKeywords.length / dept.keywords.length) * 100), foundKeywords, missingKeywords: dept.keywords.filter(k => !foundKeywords.includes(k)), totalKeywords: dept.keywords.length };
        }

        function quickAdd() {
            const text = prompt('üìã Collez le contenu du profil LinkedIn ici (Ctrl+V / Cmd+V) :');
            if (!text || text.length < 50) {
                alert('‚ùå Le texte est vide ou trop court. Veuillez copier le profil complet depuis LinkedIn.');
                return;
            }
            const rawLinkedinUrl = prompt('üîó Collez l\'URL du profil LinkedIn (optionnel) :') || '';
            let linkedinUrl = '';
            if (rawLinkedinUrl.trim() !== '' && isValidLinkedInURL(rawLinkedinUrl.trim())) {
                linkedinUrl = rawLinkedinUrl.trim();
            }
            const extracted = extractProfileInfo(text);
            const analysis = analyzeProfile(text);
            let firstName = extracted.firstName || (linkedinUrl ? extractNameFromLinkedInUrl(linkedinUrl).firstName : '') || 'Pr√©nom';
            let lastName = extracted.lastName || (linkedinUrl ? extractNameFromLinkedInUrl(linkedinUrl).lastName : '') || 'Nom';
            let autoDept = '', maxScore = 0;
            state.departments.forEach(dept => {
                const deptAnalysis = calculateDeptScore(text, dept.name);
                if (deptAnalysis.score > maxScore) { maxScore = deptAnalysis.score; autoDept = dept.name; }
            });
            const deptAnalysis = calculateDeptScore(text, autoDept);
            const newEmployee = {
                id: Date.now(), firstName, lastName, position: extracted.position || 'Poste', department: autoDept,
                company: extracted.company || state.targetCompany, linkedinUrl, email: '', profileText: text,
                globalScore: analysis.globalScore, axisScores: analysis.axisScores, wordCount: analysis.wordCount,
                analyzedAt: analysis.analyzedAt, deptScore: deptAnalysis.score, deptFoundKeywords: deptAnalysis.foundKeywords,
                deptMissingKeywords: deptAnalysis.missingKeywords, deptTotalKeywords: deptAnalysis.totalKeywords, createdAt: new Date().toISOString()
            };
            Object.assign(newEmployee, calculateLinkedInScore(text, newEmployee), calculateSSI(text, newEmployee));
            state.employees.push(newEmployee);
            saveState();
            render();
            alert('‚úÖ Profil ajout√© : ' + newEmployee.firstName + ' ' + newEmployee.lastName + '\n\nüìä Score SSI : ' + newEmployee.ssiScore + '/100\nüîµ Score LinkedIn : ' + newEmployee.linkedinGlobalScore + '/100\nüß¨ Score ADN : ' + newEmployee.globalScore + '/100\nüíº Score M√©tier : ' + newEmployee.deptScore + '/100');
        }

        function deleteEmployee(id) {
            if (confirm('Supprimer ce collaborateur ?')) {
                state.employees = state.employees.filter(emp => emp.id !== id);
                saveState();
                render();
            }
        }

        function viewEmployee(id) {
            state.selectedEmployee = state.employees.find(emp => emp.id === id);
            state.currentView = 'detail';
            render();
        }

        function exportData() {
            const blob = new Blob([JSON.stringify({ employees: state.employees, brandDNA: state.brandDNA, departments: state.departments, targetCompany: state.targetCompany }, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'linkedin-analyzer-' + Date.now() + '.json';
            a.click();
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è Supprimer TOUTES les donn√©es ? Cette action est irr√©versible.')) {
                state.employees = [];
                saveState();
                render();
            }
        }

        function getScoreBadge(score) {
            if (score >= 70) return 'bg-green-100 text-green-800';
            if (score >= 40) return 'bg-yellow-100 text-yellow-800';
            return 'bg-red-100 text-red-800';
        }

        function getScoreColor(score) {
            if (score >= 70) return 'text-green-600';
            if (score >= 40) return 'text-yellow-600';
            return 'text-red-600';
        }

        function handleAddEmployee(event) {
            event.preventDefault();
            const profileText = document.getElementById('profileText').value;
            const linkedinUrl = document.getElementById('linkedinUrl')?.value || '';
            const email = document.getElementById('email')?.value || '';
            const department = document.getElementById('department').value;
            if (linkedinUrl && !isValidLinkedInURL(linkedinUrl)) { alert('‚ö†Ô∏è URL LinkedIn invalide'); return; }
            if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { alert('‚ö†Ô∏è Email invalide'); return; }
            const analysis = analyzeProfile(profileText);
            const deptAnalysis = calculateDeptScore(profileText, department);
            const newEmployee = {
                id: Date.now(), firstName: document.getElementById('firstName').value, lastName: document.getElementById('lastName').value,
                position: document.getElementById('position').value, department, company: document.getElementById('company').value,
                email, linkedinUrl, profileText, globalScore: analysis.globalScore, axisScores: analysis.axisScores,
                wordCount: analysis.wordCount, analyzedAt: analysis.analyzedAt, deptScore: deptAnalysis.score,
                deptFoundKeywords: deptAnalysis.foundKeywords, deptMissingKeywords: deptAnalysis.missingKeywords,
                deptTotalKeywords: deptAnalysis.totalKeywords, createdAt: new Date().toISOString()
            };
            Object.assign(newEmployee, calculateLinkedInScore(profileText, newEmployee), calculateSSI(profileText, newEmployee));
            state.employees.push(newEmployee);
            saveState();
            state.currentView = 'list';
            render();
            alert('‚úÖ Profil ajout√© avec succ√®s !');
        }

        function renderHeader() {
            return `<header class="bg-gradient-to-r from-blue-900 to-blue-800 shadow-lg border-b">
                <div class="max-w-7xl mx-auto px-4 py-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h1 class="text-2xl font-bold text-white">Analyseur LinkedIn - Cyrus Herez</h1>
                            <p class="text-sm text-blue-100 mt-1">Alignement des profils avec l'ADN de l'entreprise</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="exportData()" class="p-2 text-white hover:bg-blue-700 rounded-lg" title="Exporter">üì•</button>
                            <button onclick="clearAllData()" class="p-2 text-white hover:bg-red-700 rounded-lg" title="Tout supprimer">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
            </header>`;
        }

        function renderEmployeeList() {
            const avgScore = state.employees.length > 0 ? Math.round(state.employees.reduce((sum, emp) => sum + emp.globalScore, 0) / state.employees.length) : 0;
            const avgLinkedInScore = state.employees.length > 0 ? Math.round(state.employees.reduce((sum, emp) => sum + (emp.linkedinGlobalScore || 0), 0) / state.employees.length) : 0;
            const avgSSIScore = state.employees.length > 0 ? Math.round(state.employees.reduce((sum, emp) => sum + (emp.ssiScore || 0), 0) / state.employees.length) : 0;
            
            let html = `<div class="space-y-4">
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border border-blue-200">
                    <h3 class="text-lg font-bold text-blue-900 mb-2">üèõÔ∏è Cyrus Herez - Gestion Patrimoniale</h3>
                    <p class="text-sm text-blue-800 mb-3">${state.companyMission}</p>
                </div>`;
            
            if (state.employees.length > 0) {
                html += `<div class="grid grid-cols-5 gap-4">
                    <div class="bg-white p-4 rounded-lg shadow-sm text-center"><p class="text-3xl font-bold text-blue-600">${state.employees.length}</p><p class="text-sm text-gray-600">Profils</p></div>
                    <div class="bg-white p-4 rounded-lg shadow-sm text-center"><p class="text-3xl font-bold text-purple-600">${avgSSIScore}</p><p class="text-sm text-gray-600">SSI moyen</p></div>
                    <div class="bg-white p-4 rounded-lg shadow-sm text-center"><p class="text-3xl font-bold text-indigo-600">${avgLinkedInScore}</p><p class="text-sm text-gray-600">LinkedIn moyen</p></div>
                    <div class="bg-white p-4 rounded-lg shadow-sm text-center"><p class="text-3xl font-bold text-green-600">${avgScore}</p><p class="text-sm text-gray-600">ADN moyen</p></div>
                    <div class="bg-white p-4 rounded-lg shadow-sm text-center"><p class="text-3xl font-bold text-orange-600">${state.employees.filter(e => e.ssiScore >= 75).length}</p><p class="text-sm text-gray-600">SSI excellents</p></div>
                </div>`;
            }
            
            html += `<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button onclick="quickAdd()" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white py-4 rounded-lg hover:from-blue-700 hover:to-blue-800 shadow-lg">
                    <div class="font-bold">‚ö° Coller le texte</div>
                    <div class="text-xs opacity-90">Copier-coller le profil LinkedIn</div>
                </button>
                <button onclick="openFileModal()" class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-4 rounded-lg hover:from-indigo-700 hover:to-purple-700 shadow-lg">
                    <div class="font-bold">üìÑ Importer un fichier</div>
                    <div class="text-xs opacity-90">PDF ou capture d'√©cran</div>
                </button>
                <button onclick="state.currentView = 'add'; render();" class="bg-white border-2 border-gray-300 text-gray-700 py-4 rounded-lg hover:bg-gray-50">
                    <div class="font-bold">‚ûï Saisie manuelle</div>
                    <div class="text-xs text-gray-600">Formulaire complet</div>
                </button>
            </div>`;
            
            html += '<div class="grid gap-4">';
            state.employees.forEach(emp => {
                const importBadge = emp.importedFrom === 'file' ? '<span class="text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded ml-2">üìÑ</span>' : '';
                html += `<div class="bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <h3 class="text-lg font-semibold text-gray-900">${emp.firstName} ${emp.lastName}</h3>
                                ${importBadge}
                                ${emp.email ? '<span class="text-sm">üìß</span>' : ''}
                                ${emp.linkedinUrl && isValidLinkedInURL(emp.linkedinUrl) ? '<span class="text-sm">üîó</span>' : ''}
                            </div>
                            <p class="text-gray-600">${emp.position}</p>
                            <div class="flex gap-2 mt-1 text-sm">
                                <span class="text-gray-500">${emp.department}</span>
                                ${emp.company ? '<span class="text-gray-400">‚Ä¢</span><span class="text-gray-500">' + emp.company + '</span>' : ''}
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <div class="text-center"><div class="px-3 py-1 rounded-full text-sm font-semibold ${getScoreBadge(emp.ssiScore || 0)}">${emp.ssiScore || 0}</div><p class="text-xs text-gray-500 mt-1">SSI</p></div>
                            <div class="text-center"><div class="px-3 py-1 rounded-full text-sm font-semibold ${getScoreBadge(emp.linkedinGlobalScore || 0)}">${emp.linkedinGlobalScore || 0}</div><p class="text-xs text-gray-500 mt-1">LinkedIn</p></div>
                            <div class="text-center"><div class="px-3 py-1 rounded-full text-sm font-semibold ${getScoreBadge(emp.globalScore)}">${emp.globalScore}</div><p class="text-xs text-gray-500 mt-1">ADN</p></div>
                            <div class="text-center"><div class="px-3 py-1 rounded-full text-sm font-semibold ${getScoreBadge(emp.deptScore)}">${emp.deptScore}</div><p class="text-xs text-gray-500 mt-1">M√©tier</p></div>
                        </div>
                    </div>
                    <div class="flex gap-2 mt-4">
                        <button onclick="viewEmployee(${emp.id})" class="flex-1 px-3 py-2 bg-blue-50 text-blue-600 rounded hover:bg-blue-100 text-sm font-medium">Voir la fiche</button>
                        ${emp.linkedinUrl && isValidLinkedInURL(emp.linkedinUrl) ? '<a href="' + emp.linkedinUrl + '" target="_blank" class="px-3 py-2 text-blue-600 hover:bg-blue-50 rounded text-sm">üîó</a>' : ''}
                        <button onclick="deleteEmployee(${emp.id})" class="px-3 py-2 text-red-600 hover:bg-red-50 rounded text-sm">üóëÔ∏è</button>
                    </div>
                </div>`;
            });
            html += '</div>';
            
            if (state.employees.length === 0) {
                html += `<div class="text-center py-12 bg-white rounded-lg">
                    <div class="text-6xl mb-4">üìä</div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Aucun profil analys√©</h3>
                    <p class="text-gray-600 mb-4">Commencez par ajouter un profil LinkedIn</p>
                    <div class="text-sm text-gray-500 max-w-md mx-auto bg-blue-50 p-4 rounded-lg">
                        <p class="font-medium mb-2">üí° 3 fa√ßons d'ajouter un profil :</p>
                        <div class="text-left space-y-2">
                            <p><strong>‚ö° Coller le texte</strong> - Copiez tout depuis LinkedIn</p>
                            <p><strong>üìÑ Importer un fichier</strong> - PDF ou capture d'√©cran</p>
                            <p><strong>‚ûï Saisie manuelle</strong> - Formulaire complet</p>
                        </div>
                    </div>
                </div>`;
            }
            
            html += '</div>';
            return html;
        }

        function renderEmployeeDetail() {
            const emp = state.selectedEmployee;
            if (!emp) return '';
            const importBadge = emp.importedFrom === 'file' ? '<span class="text-sm bg-purple-100 text-purple-700 px-3 py-1 rounded-full ml-3">üìÑ Import√©</span>' : '';
            const strongAxes = emp.axisScores.filter(axis => axis.score >= 60);
            const weakAxes = emp.axisScores.filter(axis => axis.score < 60);
            
            let html = `<div class="space-y-6">
                <button onclick="state.currentView = 'list'; render();" class="text-blue-600 hover:text-blue-700 font-medium">‚Üê Retour</button>
                
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <div class="flex items-center gap-3 mb-2">
                                <h2 class="text-3xl font-bold text-gray-900">${emp.firstName} ${emp.lastName}</h2>
                                ${importBadge}
                            </div>
                            <p class="text-lg text-gray-600">${emp.position}</p>
                            <p class="text-gray-500">${emp.department} ‚Ä¢ ${emp.company}</p>
                        </div>
                        <button onclick="deleteEmployee(${emp.id})" class="p-2 text-red-600 hover:bg-red-50 rounded">üóëÔ∏è</button>
                    </div>
                    ${emp.linkedinUrl ? '<a href="' + emp.linkedinUrl + '" target="_blank" class="text-blue-600 hover:underline text-sm">üîó Voir sur LinkedIn</a>' : ''}
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h3 class="text-lg font-semibold mb-4">üèÜ Scores globaux</h3>
                    <div class="grid grid-cols-4 gap-4">
                        <div><p class="text-sm text-gray-600 mb-2">üìä SSI</p><span class="text-4xl font-bold ${getScoreColor(emp.ssiScore || 0)}">${emp.ssiScore || 0}</span><span class="text-gray-500">/100</span></div>
                        <div><p class="text-sm text-gray-600 mb-2">üîµ LinkedIn</p><span class="text-4xl font-bold ${getScoreColor(emp.linkedinGlobalScore || 0)}">${emp.linkedinGlobalScore || 0}</span><span class="text-gray-500">/100</span></div>
                        <div><p class="text-sm text-gray-600 mb-2">üß¨ ADN</p><span class="text-4xl font-bold ${getScoreColor(emp.globalScore)}">${emp.globalScore}</span><span class="text-gray-500">/100</span></div>
                        <div><p class="text-sm text-gray-600 mb-2">üíº M√©tier</p><span class="text-4xl font-bold ${getScoreColor(emp.deptScore)}">${emp.deptScore}</span><span class="text-gray-500">/100</span></div>
                    </div>
                </div>`;
            
            // SSI Details
            if (emp.ssiScore !== undefined) {
                html += `<div class="bg-gradient-to-r from-indigo-50 to-blue-50 p-6 rounded-lg border border-indigo-200">
                    <h3 class="text-lg font-semibold mb-4 text-indigo-900">üìä Social Selling Index (SSI)</h3>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="bg-white p-4 rounded-lg"><p class="text-xs text-gray-600">Classement Secteur</p><p class="text-2xl font-bold text-indigo-600">Top ${emp.ssiSectorRanking}%</p></div>
                        <div class="bg-white p-4 rounded-lg"><p class="text-xs text-gray-600">Classement R√©seau</p><p class="text-2xl font-bold text-blue-600">Top ${emp.ssiNetworkRanking}%</p></div>
                    </div>
                    <div class="bg-white p-4 rounded-lg">
                        <p class="font-semibold mb-3">Les quatre facteurs</p>
                        <div class="space-y-3">
                            <div><div class="flex justify-between mb-1"><span class="text-sm">üèÜ Marque professionnelle</span><span class="font-bold">${emp.ssiBrandScore}/25</span></div><div class="w-full bg-gray-200 rounded-full h-2"><div class="h-2 rounded-full bg-orange-500" style="width: ${emp.ssiBrandScore * 4}%"></div></div></div>
                            <div><div class="flex justify-between mb-1"><span class="text-sm">üë• Bonnes personnes</span><span class="font-bold">${emp.ssiPeopleScore}/25</span></div><div class="w-full bg-gray-200 rounded-full h-2"><div class="h-2 rounded-full bg-blue-500" style="width: ${emp.ssiPeopleScore * 4}%"></div></div></div>
                            <div><div class="flex justify-between mb-1"><span class="text-sm">üí¨ √âchanger informations</span><span class="font-bold">${emp.ssiEngagementScore}/25</span></div><div class="w-full bg-gray-200 rounded-full h-2"><div class="h-2 rounded-full bg-purple-500" style="width: ${emp.ssiEngagementScore * 4}%"></div></div></div>
                            <div><div class="flex justify-between mb-1"><span class="text-sm">ü§ù √âtablir relations</span><span class="font-bold">${emp.ssiRelationScore}/25</span></div><div class="w-full bg-gray-200 rounded-full h-2"><div class="h-2 rounded-full bg-green-500" style="width: ${emp.ssiRelationScore * 4}%"></div></div></div>
                        </div>
                    </div>
                </div>`;
            }
            
            // ADN Scores
            html += `<div class="bg-white p-6 rounded-lg shadow-sm">
                <h3 class="text-lg font-semibold mb-4">üß¨ Scores ADN</h3>
                <div class="space-y-4">`;
            emp.axisScores.forEach(axis => {
                const barColor = axis.score >= 70 ? 'bg-green-500' : axis.score >= 40 ? 'bg-yellow-500' : 'bg-red-500';
                html += `<div>
                    <div class="flex justify-between mb-2"><span class="font-medium">${axis.axisName}</span><span class="font-semibold ${getScoreColor(axis.score)}">${axis.score}/100</span></div>
                    <div class="w-full bg-gray-200 rounded-full h-3"><div class="h-3 rounded-full ${barColor}" style="width: ${axis.score}%"></div></div>
                    ${axis.foundKeywords.length > 0 ? '<p class="text-sm text-gray-600 mt-1">‚úì ' + axis.foundKeywords.join(', ') + '</p>' : ''}
                </div>`;
            });
            html += '</div></div>';
            
            // M√©tier
            if (emp.department) {
                html += `<div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-lg border border-purple-200">
                    <h3 class="text-lg font-semibold mb-4 text-purple-900">üíº Score M√©tier - ${emp.department}</h3>
                    <div class="bg-white p-4 rounded-lg mb-4">
                        <div class="flex justify-between mb-3"><span>Score global</span><span class="text-2xl font-bold ${getScoreColor(emp.deptScore)}">${emp.deptScore}/100</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-3"><div class="h-3 rounded-full ${emp.deptScore >= 70 ? 'bg-green-500' : emp.deptScore >= 40 ? 'bg-yellow-500' : 'bg-red-500'}" style="width: ${emp.deptScore}%"></div></div>
                    </div>
                    ${emp.deptFoundKeywords?.length > 0 ? '<div class="bg-green-50 p-4 rounded-lg mb-4"><p class="font-semibold text-green-900 mb-2">‚úÖ Pr√©sents</p><div class="flex flex-wrap gap-2">' + emp.deptFoundKeywords.map(kw => '<span class="px-3 py-1 bg-green-200 text-green-800 rounded-full text-sm">' + kw + '</span>').join('') + '</div></div>' : ''}
                    ${emp.deptMissingKeywords?.length > 0 ? '<div class="bg-orange-50 p-4 rounded-lg"><p class="font-semibold text-orange-900 mb-2">‚ö†Ô∏è √Ä int√©grer</p><div class="flex flex-wrap gap-2">' + emp.deptMissingKeywords.slice(0, 10).map(kw => '<span class="px-3 py-1 bg-orange-200 text-orange-800 rounded-full text-sm">' + kw + '</span>').join('') + '</div></div>' : ''}
                </div>`;
            }
            
            html += `<div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                <h3 class="text-lg font-semibold mb-2 text-blue-900">üìä Synth√®se</h3>
                <p class="text-blue-800">${emp.globalScore >= 70 ? 'Profil fortement align√© avec l\'ADN.' : emp.globalScore >= 40 ? 'Profil moyennement align√©.' : 'Faible alignement avec l\'ADN.'}</p>
                <p class="text-sm text-blue-700 mt-2">üìù ${emp.wordCount} mots analys√©s</p>
            </div></div>`;
            
            return html;
        }

        function getDepartmentGroups() {
            return [
                { label: "üè¢ Direction", depts: ["Direction G√©n√©rale", "Direction des Op√©rations", "Direction Financi√®re", "Direction du D√©veloppement", "Secr√©tariat G√©n√©ral"] },
                { label: "üë• RH & Talents", depts: ["Direction des Ressources Humaines", "Recrutement & Talent Acquisition", "Formation & D√©veloppement des Comp√©tences", "Administration RH & Paie", "Relations Sociales & QVT", "Gestion des Carri√®res & Mobilit√©"] },
                { label: "üõ†Ô∏è Support", depts: ["Support Administratif & Services G√©n√©raux", "Support IT & Helpdesk", "Support Juridique & Contractuel", "Assistanat de Direction"] },
                { label: "üíº Commercial", depts: ["Direction Commerciale", "D√©veloppement Commercial & Business Development", "Conseillers Commerciaux & Banquiers Priv√©s", "Grands Comptes & Key Account Management", "Administration des Ventes & ADV", "Inside Sales & T√©l√©prospection"] },
                { label: "ü§ù Service Client", depts: ["Service Client & Relation Clients", "Middle-Office & Support Commercial", "Exp√©rience Client & Customer Success"] },
                { label: "üè¶ Patrimoine", depts: ["Conseil Patrimonial", "Gestion Financi√®re", "Immobilier & Alternatifs"] },
                { label: "üì£ Marketing", depts: ["Marketing & Communication", "Marketing Digital & Growth"] },
                { label: "‚öñÔ∏è Conformit√©", depts: ["Conformit√© & Contr√¥le Interne", "Juridique & Fiscalit√©"] },
                { label: "üìä Finance", depts: ["Comptabilit√©", "Contr√¥le de Gestion"] },
                { label: "üíª IT", depts: ["IT, Syst√®mes d'Information & Data", "D√©veloppement & Projets IT"] },
                { label: "‚öôÔ∏è Op√©rations", depts: ["Back-Office & Op√©rations"] }
            ];
        }

        function renderAddForm() {
            const groups = getDepartmentGroups();
            let deptOptions = '<option value="">S√©lectionner...</option>';
            groups.forEach(g => {
                deptOptions += `<optgroup label="${g.label}">`;
                g.depts.forEach(d => deptOptions += `<option value="${d}">${d}</option>`);
                deptOptions += '</optgroup>';
            });
            
            return `<div class="bg-white p-6 rounded-lg shadow-sm max-w-3xl mx-auto">
                <h2 class="text-xl font-bold mb-4">‚ûï Ajouter un collaborateur</h2>
                <form onsubmit="handleAddEmployee(event); return false;" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Pr√©nom *</label><input type="text" id="firstName" required class="w-full px-3 py-2 border rounded-lg" /></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Nom *</label><input type="text" id="lastName" required class="w-full px-3 py-2 border rounded-lg" /></div>
                    </div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-1">Poste</label><input type="text" id="position" class="w-full px-3 py-2 border rounded-lg" /></div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Service</label><select id="department" class="w-full px-3 py-2 border rounded-lg">${deptOptions}</select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Entreprise</label><input type="text" id="company" value="${state.targetCompany}" class="w-full px-3 py-2 border rounded-lg" /></div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">üìß Email</label><input type="email" id="email" class="w-full px-3 py-2 border rounded-lg" /></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">üîó URL LinkedIn</label><input type="url" id="linkedinUrl" class="w-full px-3 py-2 border rounded-lg" /></div>
                    </div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-1">Profil LinkedIn (texte) *</label><textarea id="profileText" required class="w-full px-3 py-2 border rounded-lg h-48" placeholder="Collez le contenu du profil..."></textarea></div>
                    <div class="flex gap-2">
                        <button type="submit" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-medium">‚úÖ Ajouter</button>
                        <button type="button" onclick="state.currentView = 'list'; render();" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300 font-medium">‚ùå Annuler</button>
                    </div>
                </form>
            </div>`;
        }

        function render() {
            const app = document.getElementById('app');
            let content = '';
            if (state.currentView === 'list') content = renderEmployeeList();
            else if (state.currentView === 'detail') content = renderEmployeeDetail();
            else if (state.currentView === 'add') content = renderAddForm();
            app.innerHTML = renderHeader() + '<main class="max-w-7xl mx-auto px-4 py-6">' + content + '</main>';
        }

        loadState();
        render();
    </script>
</body>
</html>

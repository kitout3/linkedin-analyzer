<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyseur LinkedIn - ADN de Marque</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script>
        // State management
        let state = {
            employees: [],
            brandDNA: [
                {
                    id:1, 
                    name:"Excellence patrimoniale & Expertise", 
                    weight:30, 
                    keywords:["patrimoine","patrimonial","patrimoniale","gestion","conseil","strat√©gie","strat√©gique","ing√©nierie","allocation","optimisation","expertise","expert","performance","financier","immobilier","investissement","transmission","excellence","accompagnement"]
                },
                {
                    id:2, 
                    name:"Ind√©pendance & Int√©grit√©", 
                    weight:25, 
                    keywords:["ind√©pendance","ind√©pendant","int√©grit√©","transparence","transparent","confiance","√©thique","responsable","capitalistique","partenaire","fiable","authentique"]
                },
                {
                    id:3, 
                    name:"Approche sur-mesure & Client", 
                    weight:25, 
                    keywords:["sur-mesure","personnalis√©","personnalisation","client","dirigeant","entrepreneur","famille","accompagnement","√©coute","solution","adapt√©","individuel","relation","proximit√©","orientation"]
                },
                {
                    id:4, 
                    name:"Vision long-terme & Durabilit√©", 
                    weight:20, 
                    keywords:["long-terme","p√©renne","durable","durabilit√©","transmission","transmissible","impact","avenir","coh√©rent","vision","objectif","croissance","transformation","√©volution"]
                }
            ],
            departments: [
                {id:1, name:"Conseil Patrimonial", keywords:["conseil","patrimoine","strat√©gie","gestion","accompagnement","client","optimisation","transmission"]},
                {id:2, name:"Gestion Financi√®re", keywords:["finance","financier","investissement","allocation","performance","portefeuille","gestion","analyse"]},
                {id:3, name:"Immobilier & Alternatifs", keywords:["immobilier","alternatif","investissement","placement","actif","diversification","rendement"]},
                {id:4, name:"Direction & Management", keywords:["direction","management","strat√©gie","d√©veloppement","leadership","√©quipe","vision","transformation"]}
            ],
            targetCompany: 'Cyrus Herez',
            currentView: 'list',
            selectedEmployee: null,
            companyMission: "Cyrus Herez accompagne les dirigeants, entrepreneurs et familles dans la construction, la s√©curisation et la transmission de leur patrimoine gr√¢ce √† une approche globale int√©grant conseil strat√©gique, ing√©nierie patrimoniale, allocation financi√®re, immobilier et investissements alternatifs."
        };

        // Load from localStorage
        function loadState() {
            try {
                const saved = localStorage.getItem('employees');
                if (saved) state.employees = JSON.parse(saved);
                
                const savedDNA = localStorage.getItem('brandDNA');
                if (savedDNA) state.brandDNA = JSON.parse(savedDNA);
                
                const savedDepts = localStorage.getItem('departments');
                if (savedDepts) state.departments = JSON.parse(savedDepts);
                
                const savedCompany = localStorage.getItem('targetCompany');
                if (savedCompany) state.targetCompany = savedCompany;
            } catch (e) {
                console.error('Error loading state:', e);
            }
        }

        // Save state
        function saveState() {
            localStorage.setItem('employees', JSON.stringify(state.employees));
            localStorage.setItem('brandDNA', JSON.stringify(state.brandDNA));
            localStorage.setItem('departments', JSON.stringify(state.departments));
            localStorage.setItem('targetCompany', state.targetCompany);
        }

        // Text processing
        function processText(text) {
            return text.toLowerCase()
                .replace(/[^\w\s√†√¢√§√©√®√™√´√Ø√Æ√¥√π√ª√º√ø√¶≈ì√ß]/gi, ' ')
                .split(/\s+/)
                .filter(word => word.length > 2);
        }

        // Extract LinkedIn username from URL
        function extractLinkedInUsername(url) {
            if (!url) return '';
            const match = url.match(/linkedin\.com\/in\/([^\/\?]+)/);
            return match ? match[1] : '';
        }

        // Validate LinkedIn URL
        function isValidLinkedInURL(url) {
            return /linkedin\.com\/in\/[^\/\?]+/.test(url);
        }

        // Extract profile info
        function extractProfileInfo(text) {
            const lines = text.split('\n').filter(l => l.trim());
            let firstName = '', lastName = '', position = '', company = '';

            const nameLine = lines[0] || '';
            const nameMatch = nameLine.match(/^([A-Z√Ä-√ø][a-z√†-√ø]+)\s+([A-Z√Ä-√ø][a-z√†-√ø]+)/);
            if (nameMatch) {
                firstName = nameMatch[1];
                lastName = nameMatch[2];
            }

            const positionKeywords = ['manager', 'director', 'ceo', 'cto', 'developer', 'engineer', 'consultant', 'analyst', 'specialist', 'coordinator', 'lead', 'head', 'chef', 'responsable', 'directeur'];
            for (const line of lines) {
                const lowerLine = line.toLowerCase();
                if (positionKeywords.some(keyword => lowerLine.includes(keyword))) {
                    position = line.trim();
                    break;
                }
            }

            for (const line of lines) {
                if (line.toLowerCase().includes('chez ') || line.toLowerCase().includes(' at ')) {
                    company = line.replace(/chez |at /gi, '').trim();
                    break;
                }
            }

            return { firstName, lastName, position, company };
        }

        // Analyze profile
        function analyzeProfile(profileText) {
            const words = processText(profileText);
            const wordCount = words.length;
            
            const axisScores = state.brandDNA.map(axis => {
                const foundKeywords = axis.keywords.filter(keyword => 
                    words.some(word => word.includes(keyword.toLowerCase()) || keyword.toLowerCase().includes(word))
                );
                const rawScore = (foundKeywords.length / axis.keywords.length) * 100;
                return {
                    axisId: axis.id,
                    axisName: axis.name,
                    score: Math.round(rawScore),
                    foundKeywords: foundKeywords,
                    missingKeywords: axis.keywords.filter(k => !foundKeywords.includes(k))
                };
            });

            const totalWeight = state.brandDNA.reduce((sum, axis) => sum + axis.weight, 0);
            const globalScore = Math.round(
                axisScores.reduce((sum, score) => {
                    const axis = state.brandDNA.find(a => a.id === score.axisId);
                    return sum + (score.score * axis.weight / totalWeight);
                }, 0)
            );

            return {
                globalScore: globalScore,
                axisScores: axisScores,
                wordCount: wordCount,
                analyzedAt: new Date().toISOString()
            };
        }

        // Calculate LinkedIn Score
        function calculateLinkedInScore(profileText, employee) {
            const text = profileText.toLowerCase();
            const words = processText(profileText);
            const wordCount = words.length;
            
            // 1. Score de compl√©tude (0-100)
            let completudeScore = 0;
            const sections = {
                hasName: (employee.firstName && employee.lastName) ? 20 : 0,
                hasPosition: employee.position ? 15 : 0,
                hasCompany: employee.company ? 10 : 0,
                hasRichContent: wordCount >= 200 ? 25 : (wordCount >= 100 ? 15 : wordCount >= 50 ? 10 : 0),
                hasExperience: (text.includes('exp√©rience') || text.includes('experience') || text.includes('depuis') || text.includes('ann√©es')) ? 15 : 0,
                hasSkills: (text.includes('comp√©tence') || text.includes('expertise') || text.includes('ma√Ætrise') || text.includes('skills')) ? 15 : 0
            };
            completudeScore = Object.values(sections).reduce((a, b) => a + b, 0);
            
            // 2. Score de coh√©rence (0-100) - bas√© sur l'alignement ADN
            const coherenceScore = employee.globalScore; // Utilise le score ADN existant
            
            // 3. Score de visibilit√©/SEO (0-100)
            let visibilityScore = 0;
            const seoKeywords = [
                'patrimoine', 'gestion', 'conseil', 'strat√©gie', 'investissement',
                'finance', 'immobilier', 'transmission', 'accompagnement', 'dirigeant',
                'entrepreneur', 'famille', 'performance', 'optimisation', 'allocation'
            ];
            const foundSEOKeywords = seoKeywords.filter(kw => text.includes(kw));
            visibilityScore = Math.min(100, (foundSEOKeywords.length / seoKeywords.length) * 100 + (wordCount >= 200 ? 20 : 0));
            
            // 4. Score d'engagement potentiel (0-100)
            let engagementScore = 0;
            const engagementIndicators = {
                hasActionVerbs: /\b(accompagn|d√©velopp|conseill|aid|soutien|guid|optimis|transform|innov|cr√©√©|r√©alis|pilote)\w*/.test(text) ? 25 : 0,
                hasNumbers: /\d+/.test(text) ? 20 : 0,
                hasImpactWords: (text.includes('impact') || text.includes('r√©sultat') || text.includes('succ√®s') || text.includes('croissance') || text.includes('am√©lioration')) ? 25 : 0,
                hasProfessionalTone: wordCount >= 150 ? 15 : (wordCount >= 80 ? 10 : 0),
                hasClientFocus: (text.includes('client') || text.includes('partenaire') || text.includes('relation')) ? 15 : 0
            };
            engagementScore = Object.values(engagementIndicators).reduce((a, b) => a + b, 0);
            
            // Score LinkedIn global (moyenne des 4 scores)
            const linkedinGlobalScore = Math.round((completudeScore + coherenceScore + visibilityScore + engagementScore) / 4);
            
            return {
                linkedinGlobalScore,
                completudeScore: Math.round(completudeScore),
                coherenceScore: Math.round(coherenceScore),
                visibilityScore: Math.round(visibilityScore),
                engagementScore: Math.round(engagementScore),
                foundSEOKeywords
            };
        }

        // Calculate department score with details
        function calculateDeptScore(profileText, deptName) {
            const dept = state.departments.find(d => d.name === deptName);
            if (!dept) return 0;
            
            const words = processText(profileText);
            const foundKeywords = dept.keywords.filter(keyword => 
                words.some(word => word.includes(keyword.toLowerCase()) || keyword.toLowerCase().includes(word))
            );
            const missingKeywords = dept.keywords.filter(k => !foundKeywords.includes(k));
            const score = Math.round((foundKeywords.length / dept.keywords.length) * 100);
            
            return {
                score: score,
                foundKeywords: foundKeywords,
                missingKeywords: missingKeywords,
                totalKeywords: dept.keywords.length
            };
        }

        // Quick add from clipboard
        function quickAdd() {
            const text = prompt('üìã Collez le contenu du profil LinkedIn ici (Ctrl+V / Cmd+V) :');
            
            if (!text || text.length < 50) {
                alert('‚ùå Le texte est vide ou trop court. Veuillez copier le profil complet depuis LinkedIn.');
                return;
            }

            const extracted = extractProfileInfo(text);
            const analysis = analyzeProfile(text);
            
            let autoDept = '';
            let maxScore = 0;
            state.departments.forEach(dept => {
                const deptAnalysis = calculateDeptScore(text, dept.name);
                if (deptAnalysis.score > maxScore) {
                    maxScore = deptAnalysis.score;
                    autoDept = dept.name;
                }
            });

            const deptAnalysis = calculateDeptScore(text, autoDept);

            const newEmployee = {
                id: Date.now(),
                firstName: extracted.firstName || 'Pr√©nom',
                lastName: extracted.lastName || 'Nom',
                position: extracted.position || 'Poste',
                department: autoDept,
                company: extracted.company || state.targetCompany,
                linkedinUrl: '',
                profileText: text,
                globalScore: analysis.globalScore,
                axisScores: analysis.axisScores,
                wordCount: analysis.wordCount,
                analyzedAt: analysis.analyzedAt,
                deptScore: deptAnalysis.score,
                deptFoundKeywords: deptAnalysis.foundKeywords,
                deptMissingKeywords: deptAnalysis.missingKeywords,
                deptTotalKeywords: deptAnalysis.totalKeywords,
                createdAt: new Date().toISOString()
            };

            // Calculate LinkedIn scores
            const linkedinScores = calculateLinkedInScore(text, newEmployee);
            Object.assign(newEmployee, linkedinScores);

            state.employees.push(newEmployee);
            saveState();
            render();
            alert('‚úÖ Profil ajout√© : ' + newEmployee.firstName + ' ' + newEmployee.lastName + '\nüìä Score ADN : ' + newEmployee.globalScore + '/100' + '\nüîµ Score LinkedIn : ' + newEmployee.linkedinGlobalScore + '/100' + '\nüíº Score M√©tier : ' + newEmployee.deptScore + '/100');
        }

        // Delete employee
        function deleteEmployee(id) {
            if (confirm('Supprimer ce collaborateur ?')) {
                state.employees = state.employees.filter(emp => emp.id !== id);
                saveState();
                render();
            }
        }

        // View employee
        function viewEmployee(id) {
            state.selectedEmployee = state.employees.find(emp => emp.id === id);
            state.currentView = 'detail';
            render();
        }

        // Export data
        function exportData() {
            const data = {
                employees: state.employees,
                brandDNA: state.brandDNA,
                departments: state.departments,
                targetCompany: state.targetCompany
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'linkedin-analyzer-' + Date.now() + '.json';
            a.click();
        }

        // Clear all data
        function clearAllData() {
            if (confirm('‚ö†Ô∏è Supprimer TOUTES les donn√©es ? Cette action est irr√©versible.')) {
                state.employees = [];
                saveState();
                render();
                alert('‚úÖ Toutes les donn√©es ont √©t√© supprim√©es');
            }
        }

        // Get score badge class
        function getScoreBadge(score) {
            if (score >= 70) return 'bg-green-100 text-green-800';
            if (score >= 40) return 'bg-yellow-100 text-yellow-800';
            return 'bg-red-100 text-red-800';
        }

        // Get score color
        function getScoreColor(score) {
            if (score >= 70) return 'text-green-600';
            if (score >= 40) return 'text-yellow-600';
            return 'text-red-600';
        }

        // Update company
        function updateCompany(value) {
            state.targetCompany = value;
            saveState();
        }

        // Handle add employee form
        function handleAddEmployee(event) {
            event.preventDefault();
            
            const profileText = document.getElementById('profileText').value;
            const linkedinUrl = document.getElementById('linkedinUrl') ? document.getElementById('linkedinUrl').value : '';
            const email = document.getElementById('email') ? document.getElementById('email').value : '';
            const analysis = analyzeProfile(profileText);
            const department = document.getElementById('department').value;
            
            // Validate LinkedIn URL if provided
            if (linkedinUrl && !isValidLinkedInURL(linkedinUrl)) {
                alert('‚ö†Ô∏è L\'URL LinkedIn n\'est pas au bon format.\nFormat attendu : https://www.linkedin.com/in/username/');
                return;
            }
            
            // Validate email if provided
            if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                alert('‚ö†Ô∏è L\'adresse email n\'est pas au bon format.');
                return;
            }
            
            const deptAnalysis = calculateDeptScore(profileText, department);
            
            const newEmployee = {
                id: Date.now(),
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                position: document.getElementById('position').value,
                department: department,
                company: document.getElementById('company').value,
                email: email,
                linkedinUrl: linkedinUrl,
                profileText: profileText,
                globalScore: analysis.globalScore,
                axisScores: analysis.axisScores,
                wordCount: analysis.wordCount,
                analyzedAt: analysis.analyzedAt,
                deptScore: deptAnalysis.score,
                deptFoundKeywords: deptAnalysis.foundKeywords,
                deptMissingKeywords: deptAnalysis.missingKeywords,
                deptTotalKeywords: deptAnalysis.totalKeywords,
                createdAt: new Date().toISOString()
            };

            // Calculate LinkedIn scores
            const linkedinScores = calculateLinkedInScore(profileText, newEmployee);
            Object.assign(newEmployee, linkedinScores);

            state.employees.push(newEmployee);
            saveState();
            state.currentView = 'list';
            render();
            alert('‚úÖ Profil ajout√© avec succ√®s !');
        }

        // Render functions
        function renderHeader() {
            return '<header class="bg-gradient-to-r from-blue-900 to-blue-800 shadow-lg border-b">' +
                '<div class="max-w-7xl mx-auto px-4 py-4">' +
                    '<div class="flex items-center justify-between">' +
                        '<div>' +
                            '<h1 class="text-2xl font-bold text-white">Analyseur LinkedIn - Cyrus Herez</h1>' +
                            '<p class="text-sm text-blue-100 mt-1">Alignement des profils avec l\'ADN de l\'entreprise</p>' +
                        '</div>' +
                        '<div class="flex gap-2">' +
                            '<button onclick="exportData()" class="p-2 text-white hover:bg-blue-700 rounded-lg" title="Exporter">üì•</button>' +
                            '<button onclick="clearAllData()" class="p-2 text-white hover:bg-red-700 rounded-lg" title="Tout supprimer">üóëÔ∏è</button>' +
                        '</div>' +
                    '</div>' +
                '</div>' +
            '</header>';
        }

        function renderEmployeeList() {
            const avgScore = state.employees.length > 0 
                ? Math.round(state.employees.reduce((sum, emp) => sum + emp.globalScore, 0) / state.employees.length)
                : 0;
            const avgLinkedInScore = state.employees.length > 0 
                ? Math.round(state.employees.reduce((sum, emp) => sum + (emp.linkedinGlobalScore || 0), 0) / state.employees.length)
                : 0;

            let html = '<div class="space-y-4">';
            
            // Company target
            html += '<div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border border-blue-200">' +
                '<div class="flex items-start gap-4">' +
                    '<div class="flex-1">' +
                        '<h3 class="text-lg font-bold text-blue-900 mb-2">üèõÔ∏è Cyrus Herez - Gestion Patrimoniale</h3>' +
                        '<p class="text-sm text-blue-800 mb-3">' + state.companyMission + '</p>' +
                        '<div class="grid grid-cols-2 gap-2 text-xs">' +
                            '<div class="bg-white/50 p-2 rounded">' +
                                '<span class="font-semibold">Valeurs cl√©s :</span> Ind√©pendance ‚Ä¢ Int√©grit√© ‚Ä¢ Transparence ‚Ä¢ Excellence' +
                            '</div>' +
                            '<div class="bg-white/50 p-2 rounded">' +
                                '<span class="font-semibold">Expertise :</span> Conseil patrimonial ‚Ä¢ Gestion financi√®re ‚Ä¢ Immobilier' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                '</div>' +
            '</div>';

            // Stats
            if (state.employees.length > 0) {
                html += '<div class="grid grid-cols-4 gap-4">' +
                    '<div class="bg-white p-4 rounded-lg shadow-sm text-center">' +
                        '<p class="text-3xl font-bold text-blue-600">' + state.employees.length + '</p>' +
                        '<p class="text-sm text-gray-600">Profils</p>' +
                    '</div>' +
                    '<div class="bg-white p-4 rounded-lg shadow-sm text-center">' +
                        '<p class="text-3xl font-bold text-indigo-600">' + avgLinkedInScore + '</p>' +
                        '<p class="text-sm text-gray-600">Score LinkedIn moyen</p>' +
                    '</div>' +
                    '<div class="bg-white p-4 rounded-lg shadow-sm text-center">' +
                        '<p class="text-3xl font-bold text-green-600">' + avgScore + '</p>' +
                        '<p class="text-sm text-gray-600">Score ADN moyen</p>' +
                    '</div>' +
                    '<div class="bg-white p-4 rounded-lg shadow-sm text-center">' +
                        '<p class="text-3xl font-bold text-purple-600">' + state.employees.filter(e => e.linkedinGlobalScore >= 70).length + '</p>' +
                        '<p class="text-sm text-gray-600">Profils excellents</p>' +
                    '</div>' +
                '</div>';
            }

            // Add buttons
            html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">' +
                '<button onclick="quickAdd()" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white py-4 rounded-lg hover:from-blue-700 hover:to-blue-800 shadow-lg">' +
                    '<div class="font-bold">‚ö° Coller rapidement</div>' +
                    '<div class="text-xs opacity-90">Copier le profil LinkedIn, puis cliquer ici</div>' +
                '</button>' +
                '<button onclick="state.currentView = \'add\'; render();" class="bg-white border-2 border-gray-300 text-gray-700 py-4 rounded-lg hover:bg-gray-50">' +
                    '<div class="font-bold">‚ûï Ajouter manuellement</div>' +
                    '<div class="text-xs text-gray-600">Remplir le formulaire complet</div>' +
                '</button>' +
            '</div>';

            // Employee list
            html += '<div class="grid gap-4">';
            state.employees.forEach(emp => {
                html += '<div class="bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow">' +
                    '<div class="flex items-start justify-between">' +
                        '<div class="flex-1">' +
                            '<div class="flex items-center gap-2">' +
                                '<h3 class="text-lg font-semibold text-gray-900">' + emp.firstName + ' ' + emp.lastName + '</h3>' +
                                (emp.email ? '<span class="text-sm" title="Email disponible">üìß</span>' : '') +
                                (emp.linkedinUrl && isValidLinkedInURL(emp.linkedinUrl) ? '<span class="text-sm" title="Profil LinkedIn disponible">üîó</span>' : '') +
                            '</div>' +
                            '<p class="text-gray-600">' + emp.position + '</p>' +
                            '<div class="flex gap-2 mt-1 text-sm">' +
                                '<span class="text-gray-500">' + emp.department + '</span>' +
                                (emp.company ? '<span class="text-gray-400">‚Ä¢</span><span class="text-gray-500">' + emp.company + '</span>' : '') +
                            '</div>' +
                            (emp.email ? '<div class="mt-1"><span class="text-xs text-gray-500">‚úâÔ∏è ' + emp.email + '</span></div>' : '') +
                        '</div>' +
                        '<div class="flex gap-2">' +
                            '<div class="text-center">' +
                                '<div class="px-3 py-1 rounded-full text-sm font-semibold ' + getScoreBadge(emp.linkedinGlobalScore || 0) + '">' + (emp.linkedinGlobalScore || 0) + '</div>' +
                                '<p class="text-xs text-gray-500 mt-1">LinkedIn</p>' +
                            '</div>' +
                            '<div class="text-center">' +
                                '<div class="px-3 py-1 rounded-full text-sm font-semibold ' + getScoreBadge(emp.globalScore) + '">' + emp.globalScore + '</div>' +
                                '<p class="text-xs text-gray-500 mt-1">ADN</p>' +
                            '</div>' +
                            '<div class="text-center">' +
                                '<div class="px-3 py-1 rounded-full text-sm font-semibold ' + getScoreBadge(emp.deptScore) + '">' + emp.deptScore + '</div>' +
                                '<p class="text-xs text-gray-500 mt-1">M√©tier</p>' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                    '<div class="flex gap-2 mt-4">' +
                        '<button onclick="viewEmployee(' + emp.id + ')" class="flex-1 px-3 py-2 bg-blue-50 text-blue-600 rounded hover:bg-blue-100 text-sm font-medium">Voir la fiche</button>' +
                        (emp.email ? '<a href="mailto:' + emp.email + '" class="px-3 py-2 text-gray-600 hover:bg-gray-50 rounded text-sm" title="Envoyer un email">‚úâÔ∏è</a>' : '') +
                        (emp.linkedinUrl && isValidLinkedInURL(emp.linkedinUrl) ? 
                            '<a href="' + emp.linkedinUrl + '" target="_blank" rel="noopener noreferrer" class="px-3 py-2 text-blue-600 hover:bg-blue-50 rounded text-sm" title="Ouvrir LinkedIn">üîó</a>' : '') +
                        '<button onclick="deleteEmployee(' + emp.id + ')" class="px-3 py-2 text-red-600 hover:bg-red-50 rounded text-sm">üóëÔ∏è</button>' +
                    '</div>' +
                '</div>';
            });
            html += '</div>';

            // Empty state
            if (state.employees.length === 0) {
                html += '<div class="text-center py-12 bg-white rounded-lg">' +
                    '<div class="text-6xl mb-4">üìä</div>' +
                    '<h3 class="text-lg font-semibold text-gray-900 mb-2">Aucun profil analys√© pour le moment</h3>' +
                    '<p class="text-gray-600 mb-4">Commencez √† √©valuer l\'alignement des profils avec l\'ADN de Cyrus Herez</p>' +
                    '<div class="text-sm text-gray-500 max-w-md mx-auto">' +
                        '<p class="font-medium mb-2">üí° Comment analyser un profil LinkedIn ?</p>' +
                        '<ol class="text-left space-y-2 bg-blue-50 p-4 rounded-lg">' +
                            '<li>1Ô∏è‚É£ Ouvrez un profil LinkedIn (ex: linkedin.com/in/username/)</li>' +
                            '<li>2Ô∏è‚É£ S√©lectionnez tout le texte (Ctrl+A ou Cmd+A)</li>' +
                            '<li>3Ô∏è‚É£ Copiez le texte (Ctrl+C ou Cmd+C)</li>' +
                            '<li>4Ô∏è‚É£ Cliquez sur "‚ö° Coller rapidement"</li>' +
                            '<li>5Ô∏è‚É£ Collez dans la fen√™tre qui s\'ouvre (Ctrl+V ou Cmd+V)</li>' +
                            '<li>6Ô∏è‚É£ L\'analyse se fait automatiquement selon les 4 axes ADN !</li>' +
                        '</ol>' +
                        '<div class="mt-3 p-3 bg-yellow-50 rounded text-left">' +
                            '<p class="font-semibold text-yellow-800 mb-1">üí° Astuce :</p>' +
                            '<p class="text-xs text-yellow-700">Pour ajouter l\'URL LinkedIn, utilisez "Ajouter manuellement" et renseignez l\'URL au format : https://www.linkedin.com/in/username/</p>' +
                        '</div>' +
                        '<div class="mt-4 p-3 bg-green-50 rounded text-left">' +
                            '<p class="font-semibold text-green-800 mb-1">üìà Axes d\'analyse :</p>' +
                            '<p class="text-xs text-green-700">‚Ä¢ Excellence patrimoniale & Expertise (30%)</p>' +
                            '<p class="text-xs text-green-700">‚Ä¢ Ind√©pendance & Int√©grit√© (25%)</p>' +
                            '<p class="text-xs text-green-700">‚Ä¢ Approche sur-mesure & Client (25%)</p>' +
                            '<p class="text-xs text-green-700">‚Ä¢ Vision long-terme & Durabilit√© (20%)</p>' +
                        '</div>' +
                    '</div>' +
                '</div>';
            }

            html += '</div>';
            return html;
        }

        function renderEmployeeDetail() {
            const emp = state.selectedEmployee;
            if (!emp) return '';

            const getSummary = () => {
                if (emp.globalScore >= 70) return 'Ce profil est fortement align√© avec l\'ADN de la marque.';
                if (emp.globalScore >= 40) return 'Ce profil est moyennement align√© avec l\'ADN de la marque.';
                return 'Ce profil pr√©sente un faible alignement avec l\'ADN de la marque.';
            };

            const strongAxes = emp.axisScores.filter(axis => axis.score >= 60);
            const weakAxes = emp.axisScores.filter(axis => axis.score < 50);

            let html = '<div class="space-y-6">';
            
            html += '<button onclick="state.currentView = \'list\'; render();" class="text-blue-600 hover:text-blue-700 font-medium">‚Üê Retour √† la liste</button>';

            html += '<div class="bg-white p-6 rounded-lg shadow-sm">' +
                '<div class="flex items-start justify-between mb-4">' +
                    '<div class="flex-1">' +
                        '<div class="flex items-center gap-3 mb-2">' +
                            '<h2 class="text-3xl font-bold text-gray-900">' + emp.firstName + ' ' + emp.lastName + '</h2>' +
                            (emp.linkedinUrl && isValidLinkedInURL(emp.linkedinUrl) ? '<span class="text-2xl" title="Profil LinkedIn disponible">üîó</span>' : '') +
                            (emp.email ? '<span class="text-2xl" title="Email disponible">üìß</span>' : '') +
                        '</div>' +
                        '<p class="text-lg text-gray-600">' + emp.position + '</p>' +
                        '<div class="flex items-center gap-2 mt-2">' +
                            '<span class="text-gray-500">' + emp.department + '</span>' +
                            (emp.company ? '<span class="text-gray-400">‚Ä¢</span><span class="text-gray-500">' + emp.company + '</span>' : '') +
                        '</div>' +
                    '</div>' +
                    '<div class="flex gap-2">' +
                        '<button onclick="state.currentView = \'edit\'; state.selectedEmployee = state.employees.find(e => e.id === ' + emp.id + '); render();" class="p-2 text-blue-600 hover:bg-blue-50 rounded" title="Modifier">‚úèÔ∏è</button>' +
                        '<button onclick="if(confirm(\'Supprimer ce collaborateur ?\')) { deleteEmployee(' + emp.id + '); }" class="p-2 text-red-600 hover:bg-red-50 rounded" title="Supprimer">üóëÔ∏è</button>' +
                    '</div>' +
                '</div>';
            
            // Contact info section
            if ((emp.linkedinUrl && isValidLinkedInURL(emp.linkedinUrl)) || emp.email) {
                html += '<div class="border-t pt-4 space-y-2">';
                
                // Email
                if (emp.email) {
                    html += '<div class="flex items-center gap-3">' +
                        '<span class="text-xs font-medium text-gray-600 w-24">üìß Email :</span>' +
                        '<a href="mailto:' + emp.email + '" class="text-xs text-blue-600 hover:underline break-all flex-1">' + emp.email + '</a>' +
                        '<a href="mailto:' + emp.email + '" class="px-3 py-1.5 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 text-xs font-medium whitespace-nowrap">' +
                            '‚úâÔ∏è Envoyer' +
                        '</a>' +
                    '</div>';
                }
                
                // LinkedIn URL
                if (emp.linkedinUrl && isValidLinkedInURL(emp.linkedinUrl)) {
                    html += '<div class="flex items-center gap-3">' +
                        '<span class="text-xs font-medium text-gray-600 w-24">üîó LinkedIn :</span>' +
                        '<a href="' + emp.linkedinUrl + '" target="_blank" rel="noopener noreferrer" class="text-xs text-blue-600 hover:underline break-all flex-1">' + emp.linkedinUrl + '</a>' +
                        '<a href="' + emp.linkedinUrl + '" target="_blank" rel="noopener noreferrer" class="px-3 py-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs font-medium whitespace-nowrap">' +
                            '‚ÜóÔ∏è Ouvrir' +
                        '</a>' +
                    '</div>';
                }
                
                html += '</div>';
            }
            
            html += '</div>';

            html += '<div class="bg-white p-6 rounded-lg shadow-sm">' +
                '<h3 class="text-lg font-semibold mb-4">üèÜ Scores globaux</h3>' +
                '<div class="grid grid-cols-3 gap-6">' +
                    '<div>' +
                        '<p class="text-sm text-gray-600 mb-2">üîµ Score LinkedIn</p>' +
                        '<div class="flex items-baseline gap-2">' +
                            '<span class="text-4xl font-bold ' + getScoreColor(emp.linkedinGlobalScore || 0) + '">' + (emp.linkedinGlobalScore || 0) + '</span>' +
                            '<span class="text-gray-500">/100</span>' +
                        '</div>' +
                        '<p class="text-xs text-gray-500 mt-1">Qualit√© du profil</p>' +
                    '</div>' +
                    '<div>' +
                        '<p class="text-sm text-gray-600 mb-2">üß¨ Score ADN</p>' +
                        '<div class="flex items-baseline gap-2">' +
                            '<span class="text-4xl font-bold ' + getScoreColor(emp.globalScore) + '">' + emp.globalScore + '</span>' +
                            '<span class="text-gray-500">/100</span>' +
                        '</div>' +
                        '<p class="text-xs text-gray-500 mt-1">Alignement marque</p>' +
                    '</div>' +
                    '<div>' +
                        '<p class="text-sm text-gray-600 mb-2">üíº Score m√©tier</p>' +
                        '<div class="flex items-baseline gap-2">' +
                            '<span class="text-4xl font-bold ' + getScoreColor(emp.deptScore) + '">' + emp.deptScore + '</span>' +
                            '<span class="text-gray-500">/100</span>' +
                        '</div>' +
                        '<p class="text-xs text-gray-500 mt-1">Expertise secteur</p>' +
                    '</div>' +
                '</div>' +
            '</div>';

            // D√©tail du Score LinkedIn
            if (emp.linkedinGlobalScore) {
                html += '<div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border border-blue-200">' +
                    '<h3 class="text-lg font-semibold mb-4 text-blue-900">üîµ D√©tail du Score LinkedIn</h3>' +
                    '<div class="grid grid-cols-2 gap-4">' +
                        '<div class="bg-white p-4 rounded-lg">' +
                            '<div class="flex items-center justify-between mb-2">' +
                                '<span class="text-sm font-medium text-gray-700">üìù Compl√©tude</span>' +
                                '<span class="text-lg font-bold ' + getScoreColor(emp.completudeScore || 0) + '">' + (emp.completudeScore || 0) + '/100</span>' +
                            '</div>' +
                            '<div class="w-full bg-gray-200 rounded-full h-2">' +
                                '<div class="h-2 rounded-full bg-blue-500" style="width: ' + (emp.completudeScore || 0) + '%"></div>' +
                            '</div>' +
                            '<p class="text-xs text-gray-600 mt-1">Richesse du profil, sections remplies</p>' +
                        '</div>' +
                        '<div class="bg-white p-4 rounded-lg">' +
                            '<div class="flex items-center justify-between mb-2">' +
                                '<span class="text-sm font-medium text-gray-700">üéØ Coh√©rence</span>' +
                                '<span class="text-lg font-bold ' + getScoreColor(emp.coherenceScore || 0) + '">' + (emp.coherenceScore || 0) + '/100</span>' +
                            '</div>' +
                            '<div class="w-full bg-gray-200 rounded-full h-2">' +
                                '<div class="h-2 rounded-full bg-green-500" style="width: ' + (emp.coherenceScore || 0) + '%"></div>' +
                            '</div>' +
                            '<p class="text-xs text-gray-600 mt-1">Alignement avec l\'ADN Cyrus Herez</p>' +
                        '</div>' +
                        '<div class="bg-white p-4 rounded-lg">' +
                            '<div class="flex items-center justify-between mb-2">' +
                                '<span class="text-sm font-medium text-gray-700">üîç Visibilit√© SEO</span>' +
                                '<span class="text-lg font-bold ' + getScoreColor(emp.visibilityScore || 0) + '">' + (emp.visibilityScore || 0) + '/100</span>' +
                            '</div>' +
                            '<div class="w-full bg-gray-200 rounded-full h-2">' +
                                '<div class="h-2 rounded-full bg-purple-500" style="width: ' + (emp.visibilityScore || 0) + '%"></div>' +
                            '</div>' +
                            '<p class="text-xs text-gray-600 mt-1">Mots-cl√©s m√©tier : ' + (emp.foundSEOKeywords ? emp.foundSEOKeywords.length : 0) + ' trouv√©s</p>' +
                        '</div>' +
                        '<div class="bg-white p-4 rounded-lg">' +
                            '<div class="flex items-center justify-between mb-2">' +
                                '<span class="text-sm font-medium text-gray-700">‚ö° Engagement</span>' +
                                '<span class="text-lg font-bold ' + getScoreColor(emp.engagementScore || 0) + '">' + (emp.engagementScore || 0) + '/100</span>' +
                            '</div>' +
                            '<div class="w-full bg-gray-200 rounded-full h-2">' +
                                '<div class="h-2 rounded-full bg-orange-500" style="width: ' + (emp.engagementScore || 0) + '%"></div>' +
                            '</div>' +
                            '<p class="text-xs text-gray-600 mt-1">Impact, r√©sultats, verbes d\'action</p>' +
                        '</div>' +
                    '</div>' +
                '</div>';
            }

            // D√©tail du Score M√©tier
            if (emp.department && emp.deptScore !== undefined) {
                html += '<div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-lg border border-purple-200">' +
                    '<h3 class="text-lg font-semibold mb-4 text-purple-900">üíº D√©tail du Score M√©tier - ' + emp.department + '</h3>' +
                    '<div class="bg-white p-4 rounded-lg mb-4">' +
                        '<div class="flex items-center justify-between mb-3">' +
                            '<span class="text-base font-medium text-gray-700">Score global m√©tier</span>' +
                            '<span class="text-2xl font-bold ' + getScoreColor(emp.deptScore) + '">' + emp.deptScore + '/100</span>' +
                        '</div>' +
                        '<div class="w-full bg-gray-200 rounded-full h-3">' +
                            '<div class="h-3 rounded-full ' + (emp.deptScore >= 70 ? 'bg-green-500' : emp.deptScore >= 40 ? 'bg-yellow-500' : 'bg-red-500') + '" style="width: ' + emp.deptScore + '%"></div>' +
                        '</div>' +
                        '<p class="text-sm text-gray-600 mt-2">' +
                            'Mots-cl√©s trouv√©s : ' + (emp.deptFoundKeywords ? emp.deptFoundKeywords.length : 0) + ' / ' + (emp.deptTotalKeywords || 0) +
                        '</p>' +
                    '</div>';

                // Mots-cl√©s trouv√©s
                if (emp.deptFoundKeywords && emp.deptFoundKeywords.length > 0) {
                    html += '<div class="bg-green-50 p-4 rounded-lg mb-4">' +
                        '<p class="font-semibold text-green-900 mb-2">‚úÖ Mots-cl√©s m√©tier pr√©sents (' + emp.deptFoundKeywords.length + ')</p>' +
                        '<div class="flex flex-wrap gap-2">';
                    emp.deptFoundKeywords.forEach(keyword => {
                        html += '<span class="px-3 py-1 bg-green-200 text-green-800 rounded-full text-sm font-medium">' + keyword + '</span>';
                    });
                    html += '</div></div>';
                }

                // Mots-cl√©s manquants
                if (emp.deptMissingKeywords && emp.deptMissingKeywords.length > 0) {
                    html += '<div class="bg-orange-50 p-4 rounded-lg">' +
                        '<p class="font-semibold text-orange-900 mb-2">‚ö†Ô∏è Mots-cl√©s m√©tier √† int√©grer (' + emp.deptMissingKeywords.length + ')</p>' +
                        '<div class="flex flex-wrap gap-2">';
                    emp.deptMissingKeywords.forEach(keyword => {
                        html += '<span class="px-3 py-1 bg-orange-200 text-orange-800 rounded-full text-sm">' + keyword + '</span>';
                    });
                    html += '</div>' +
                        '<p class="text-xs text-orange-700 mt-3">üí° Astuce : Int√©grer ces mots-cl√©s dans le r√©sum√©, les exp√©riences ou les comp√©tences pour am√©liorer le score m√©tier.</p>' +
                    '</div>';
                }

                html += '</div>';
            }

            html += '<div class="bg-blue-50 p-6 rounded-lg border border-blue-200">' +
                '<h3 class="text-lg font-semibold mb-2 text-blue-900">üìä Analyse synth√©tique</h3>' +
                '<p class="text-blue-800">' + getSummary() + '</p>' +
                '<p class="text-sm text-blue-700 mt-2">üìù Richesse du profil: ' + emp.wordCount + ' mots analys√©s</p>' +
            '</div>';

            html += '<div class="bg-white p-6 rounded-lg shadow-sm">' +
                '<h3 class="text-lg font-semibold mb-4">üìä Scores par axe ADN</h3>' +
                '<div class="space-y-4">';
            
            emp.axisScores.forEach(axis => {
                const barColor = axis.score >= 70 ? 'bg-green-500' : axis.score >= 40 ? 'bg-yellow-500' : 'bg-red-500';
                html += '<div>' +
                    '<div class="flex items-center justify-between mb-2">' +
                        '<span class="font-medium">' + axis.axisName + '</span>' +
                        '<span class="font-semibold ' + getScoreColor(axis.score) + '">' + axis.score + '/100</span>' +
                    '</div>' +
                    '<div class="w-full bg-gray-200 rounded-full h-3">' +
                        '<div class="h-3 rounded-full ' + barColor + '" style="width: ' + axis.score + '%"></div>' +
                    '</div>';
                
                if (axis.foundKeywords.length > 0) {
                    html += '<p class="text-sm text-gray-600 mt-1">‚úì Mots-cl√©s trouv√©s: <span class="text-green-700">' + axis.foundKeywords.join(', ') + '</span></p>';
                }
                
                html += '</div>';
            });
            
            html += '</div></div>';

            if (strongAxes.length > 0) {
                html += '<div class="bg-green-50 p-6 rounded-lg border border-green-200">' +
                    '<h3 class="text-lg font-semibold mb-3 text-green-900">üí™ Points forts</h3>' +
                    '<div class="space-y-2">';
                
                strongAxes.forEach(axis => {
                    html += '<div>' +
                        '<p class="font-medium text-green-800">' + axis.axisName + '</p>' +
                        '<p class="text-sm text-green-700">Mots-cl√©s pr√©sents: ' + axis.foundKeywords.join(', ') + '</p>' +
                    '</div>';
                });
                
                html += '</div></div>';
            }

            if (weakAxes.length > 0) {
                html += '<div class="bg-orange-50 p-6 rounded-lg border border-orange-200">' +
                    '<h3 class="text-lg font-semibold mb-3 text-orange-900">üéØ Axes d\'am√©lioration</h3>' +
                    '<div class="space-y-3">';
                
                weakAxes.forEach(axis => {
                    html += '<div>' +
                        '<p class="font-medium text-orange-800">' + axis.axisName + '</p>' +
                        '<p class="text-sm text-orange-700">üí° Suggestions: <span class="font-medium">' + axis.missingKeywords.slice(0, 5).join(', ') + '</span></p>' +
                    '</div>';
                });
                
                html += '</div></div>';
            }

            // Recommandations LinkedIn
            if (emp.linkedinGlobalScore && emp.linkedinGlobalScore < 70) {
                html += '<div class="bg-blue-50 p-6 rounded-lg border border-blue-200">' +
                    '<h3 class="text-lg font-semibold mb-3 text-blue-900">üí° Recommandations pour am√©liorer le profil LinkedIn</h3>' +
                    '<div class="space-y-2 text-sm text-blue-800">';
                
                if (emp.completudeScore < 70) {
                    html += '<p>‚Ä¢ <strong>Compl√©tude :</strong> Enrichir le profil avec plus de d√©tails sur les exp√©riences, comp√©tences et r√©alisations</p>';
                }
                if (emp.coherenceScore < 70) {
                    html += '<p>‚Ä¢ <strong>Coh√©rence :</strong> Int√©grer les mots-cl√©s ADN Cyrus Herez : ' + state.brandDNA.map(a => a.name).slice(0, 2).join(', ') + '</p>';
                }
                if (emp.visibilityScore < 70) {
                    html += '<p>‚Ä¢ <strong>Visibilit√© :</strong> Ajouter des mots-cl√©s strat√©giques : patrimoine, gestion, conseil, strat√©gie, investissement</p>';
                }
                if (emp.engagementScore < 70) {
                    html += '<p>‚Ä¢ <strong>Engagement :</strong> Utiliser des verbes d\'action et quantifier les r√©sultats (chiffres, impacts)</p>';
                }
                
                html += '</div></div>';
            }

            html += '</div>';
            return html;
        }

        function renderAddForm() {
            let html = '<div class="bg-white p-6 rounded-lg shadow-sm max-w-3xl mx-auto">' +
                '<h2 class="text-xl font-bold mb-4">‚ûï Ajouter un collaborateur</h2>' +
                '<form onsubmit="handleAddEmployee(event); return false;" class="space-y-4">' +
                    '<div class="grid grid-cols-2 gap-4">' +
                        '<div>' +
                            '<label class="block text-sm font-medium text-gray-700 mb-1">Pr√©nom <span class="text-red-500">*</span></label>' +
                            '<input type="text" id="firstName" required class="w-full px-3 py-2 border rounded-lg" />' +
                        '</div>' +
                        '<div>' +
                            '<label class="block text-sm font-medium text-gray-700 mb-1">Nom <span class="text-red-500">*</span></label>' +
                            '<input type="text" id="lastName" required class="w-full px-3 py-2 border rounded-lg" />' +
                        '</div>' +
                    '</div>' +
                    '<div>' +
                        '<label class="block text-sm font-medium text-gray-700 mb-1">Poste</label>' +
                        '<input type="text" id="position" class="w-full px-3 py-2 border rounded-lg" />' +
                    '</div>' +
                    '<div class="grid grid-cols-2 gap-4">' +
                        '<div>' +
                            '<label class="block text-sm font-medium text-gray-700 mb-1">Service</label>' +
                            '<select id="department" class="w-full px-3 py-2 border rounded-lg">' +
                                '<option value="">S√©lectionner</option>';
            
            state.departments.forEach(dept => {
                html += '<option value="' + dept.name + '">' + dept.name + '</option>';
            });
            
            html += '</select>' +
                        '</div>' +
                        '<div>' +
                            '<label class="block text-sm font-medium text-gray-700 mb-1">Entreprise</label>' +
                            '<input type="text" id="company" value="' + state.targetCompany + '" class="w-full px-3 py-2 border rounded-lg" />' +
                        '</div>' +
                    '</div>' +
                    '<div class="grid grid-cols-2 gap-4">' +
                        '<div>' +
                            '<label class="block text-sm font-medium text-gray-700 mb-1">üìß Email</label>' +
                            '<input type="email" id="email" placeholder="prenom.nom@example.com" class="w-full px-3 py-2 border rounded-lg" />' +
                        '</div>' +
                        '<div>' +
                            '<label class="block text-sm font-medium text-gray-700 mb-1">üîó URL LinkedIn</label>' +
                            '<input type="url" id="linkedinUrl" placeholder="https://www.linkedin.com/in/username/" class="w-full px-3 py-2 border rounded-lg" />' +
                        '</div>' +
                    '</div>' +
                    '<p class="text-xs text-gray-500 -mt-2">Format LinkedIn : https://www.linkedin.com/in/username/</p>' +
                    '<div>' +
                        '<label class="block text-sm font-medium text-gray-700 mb-1">Profil LinkedIn (texte) <span class="text-red-500">*</span></label>' +
                        '<textarea id="profileText" required class="w-full px-3 py-2 border rounded-lg h-48" placeholder="Collez ici le contenu du profil LinkedIn..."></textarea>' +
                        '<p class="text-xs text-gray-500 mt-1">üí° Allez sur le profil LinkedIn, s√©lectionnez tout (Ctrl+A) et copiez (Ctrl+C), puis collez ici</p>' +
                    '</div>' +
                    '<div class="flex gap-2">' +
                        '<button type="submit" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-medium">‚úÖ Ajouter et analyser</button>' +
                        '<button type="button" onclick="state.currentView = \'list\'; render();" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300 font-medium">‚ùå Annuler</button>' +
                    '</div>' +
                '</form>' +
            '</div>';
            
            return html;
        }

        // Main render function
        function render() {
            const app = document.getElementById('app');
            
            let content = '';
            if (state.currentView === 'list') {
                content = renderEmployeeList();
            } else if (state.currentView === 'detail') {
                content = renderEmployeeDetail();
            } else if (state.currentView === 'add') {
                content = renderAddForm();
            }

            app.innerHTML = renderHeader() + '<main class="max-w-7xl mx-auto px-4 py-6">' + content + '</main>';
        }

        // Initial load and render
        loadState();
        render();
    </script>
</body>
</html>
